(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-500479ba"],{1778:function(t,e,s){"use strict";s.d(e,"d",(function(){return n})),s.d(e,"b",(function(){return r})),s.d(e,"c",(function(){return o})),s.d(e,"e",(function(){return c})),s.d(e,"f",(function(){return l})),s.d(e,"a",(function(){return u}));s("ac1f");var a=s("b775"),i={search:"/classcipe/api/v2/library/search",getLibraryRecommend:"/classcipe/api/v2/library/getLibraryRecommend",getLibraryResource:"/classcipe/api/v2/library/getLibraryResource",queryAllResource:"/classcipe/api/v2/library/queryAllResource",queryLibraryResource:"/classcipe/api/v2/library/queryLibraryResource",getLibraryPDContent:"/classcipe/api/v2/library/getLibraryPDContent"};function n(t){return Object(a["d"])({url:i.search,method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function r(t){return Object(a["d"])({url:i.getLibraryRecommend,method:"get",params:t})}function o(t){return Object(a["d"])({url:i.getLibraryResource,method:"get",params:t})}function c(t){return Object(a["d"])({url:i.queryAllResource,method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function l(t){return Object(a["d"])({url:i.queryLibraryResource,method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function u(t){return Object(a["d"])({url:i.getLibraryPDContent,method:"get",params:t})}},3881:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"user-profile-avatar"},[a("div",{staticClass:"notification",on:{click:t.handleToNotification}},[a("a-badge",{attrs:{count:t.msgUnreadCount}},[a("a-icon",{style:{fontSize:"20px",color:"#999"},attrs:{type:"mail"}})],1)],1),a("a-dropdown",{attrs:{getPopupContainer:function(t){return t.parentElement}},model:{value:t.dropVis,callback:function(e){t.dropVis=e},expression:"dropVis"}},[t.$store.getters.userInfo.avatar?a("a-avatar",{attrs:{src:t.$store.getters.userInfo.avatar}}):a("img",{attrs:{src:s("4992")}}),a("div",{staticClass:"profile-info",attrs:{slot:"overlay"},slot:"overlay"},[a("div",{staticClass:"base-info"},[a("div",{staticClass:"avatar"},[t.$store.getters.userInfo.avatar?a("a-avatar",{attrs:{src:t.$store.getters.userInfo.avatar}}):a("img",{attrs:{src:s("4992")}})],1),a("div",{staticClass:"base"},[a("div",{staticClass:"name"},[t._v(t._s(t.$store.getters.userInfo.firstname)+" "+t._s(t.$store.getters.userInfo.lastname))]),a("div",{staticClass:"email"},[t._v(t._s(t.$store.getters.userInfo.email))])])]),a("div",{staticClass:"storage-info"},[a("a-progress",{staticClass:"cc-storage-progress",attrs:{percent:t.storageProgress,"show-info":!1}}),a("div",{staticClass:"storage-info-text"},[t._v(" "+t._s(t._f("sizeFormat")(t.consumedSize))+" of "+t._s(t._f("sizeFormat")(t.totalSize))+" ")])],1),a("div",{staticClass:"plan-upgrade"},[a("a-space",[t.info.planInfo&&!t.info.planInfo.freeUsePlan?a("div",{staticClass:"free-plan"},[t._v(t._s(t.info.planInfo.planName))]):a("div",{staticClass:"free-plan"},[t._v("Free plan")]),a("div",{staticClass:"upgrade"},[t._v("Upgrade")])]),t.info.planInfo&&t.info.planInfo.planUser&&t.info.planInfo.planUser.planEndTime&&!t.info.planInfo.freeUsePlan?a("div",{staticClass:"plan-end"},[t._v(" Ends on "+t._s(t.info.planInfo.planUser.planEndTime)+" ")]):t._e()],1),a("a-divider",{staticClass:"cc-small-divider"}),a("div",{staticClass:"class-info"},[a("div",{staticClass:"class-list"},[a("div",{class:{"class-item":!0,active:t.userMode===t.USER_MODE.SELF},on:{click:t.handleChangePersonal}},[a("div",{staticClass:"class-avatar"},[t.$store.getters.userInfo.avatar?a("a-avatar",{attrs:{src:t.$store.getters.userInfo.avatar}}):a("img",{attrs:{src:s("4992")}})],1),a("div",{staticClass:"class-base-info"},[a("div",{staticClass:"class-name"},[t._v("Personal")]),a("div",{staticClass:"class-updated-by"},[t._v(t._s(t.$store.getters.userInfo.email))])])]),t._l(t.info.schoolList,(function(e){return a("div",{key:e.id,class:{"class-item":!0,active:t.userMode===t.USER_MODE.SCHOOL&&t.currentSchool.schoolName===e.schoolName},on:{click:function(s){return t.handleChangeSchool(e)}}},[a("div",{staticClass:"class-avatar"},[a("a-avatar",{staticStyle:{color:"#f56a00",backgroundColor:"#fde3cf"}},[t._v(" "+t._s(e.schoolName?e.schoolName[0].toUpperCase():"C")+" ")])],1),a("div",{staticClass:"class-base-info"},[a("div",{staticClass:"class-name"},[t._v(t._s(e.schoolName))]),a("div",{staticClass:"class-updated-by"},[e.roleNames.length>1||"teacher"!==e.roleNames[0].toLowerCase()?t._l(e.roleNames.filter((function(t){return"teacher"!==t.toLowerCase()})),(function(e){return a("div",{key:e,staticClass:"role-name"},[t._v(t._s(e))])})):a("div",{staticClass:"role-name"},[t._v("Teacher")])],2)])])}))],2)]),a("a-divider",{staticClass:"cc-small-divider"}),t.isAuth?a("div",{staticClass:"account profile-menu-item",on:{click:t.handleToAccounts}},[t.userMode===t.USER_MODE.SCHOOL?[t._v(" School account ")]:[t._v(" Account ")]],2):t._e(),a("div",{staticClass:"logout profile-menu-item",on:{click:t.handleLogout}},[t._v(" Logout ")])],1)],1)],1)},i=[],n=(s("cd17"),s("ed3b")),r=s("5530"),o=(s("99af"),s("d3b7"),s("ac1f"),s("5319"),s("caad"),s("2532"),s("d81d"),s("2f62")),c=s("c24f"),l=s("9fb0"),u=s("f93e"),h=s("6757"),d=s("0bb4"),f=s("8ee6"),m={name:"UserProfileAvatar",data:function(){return{unit:1073741824,schoolUserRole:h["a"],USER_MODE:u["Y"],msg1Count:"0",msg2Count:"0",stopTimer:!1,dropVis:!1}},computed:Object(r["a"])(Object(r["a"])({},Object(o["e"])({info:function(t){return t.user.info},currentSchool:function(t){return t.user.currentSchool},userMode:function(t){return t.app.userMode},msgUnreadCount:function(t){return t.websocket.msgUnreadCount}})),{},{msgTotal:function(){return parseInt(this.msg1Count)+parseInt(this.msg2Count)},consumedSize:function(){return this.userMode===u["Y"].SELF?1024*this.info.usedSpace:1024*this.currentSchool.usedSpace},totalSize:function(){return this.info.planInfo?this.info.planInfo.storageSpace*this.unit:this.unit},storageProgress:function(){return Math.round(this.consumedSize/this.totalSize*100)},isAuth:function(){return!0}}),created:function(){this.initData(),this.hasSetCurriculum()},methods:Object(r["a"])(Object(r["a"])(Object(r["a"])({},Object(o["d"])([l["M"],"SET_CURRENT_SCHOOL"])),Object(o["b"])(["GetClassList"])),{},{timerFun:function(){var t=this;this.stopTimer=!1;var e=setInterval((function(){t.stopTimer?clearInterval(e):t.loadData()}),6e3)},initData:function(){var t=this;Object(d["c"])().then((function(e){e.success&&(t.announcement1=e.result.anntMsgList,t.msg1Count=e.result.anntMsgTotal,t.$store.commit("SET_UNREAD_COUNT",t.msg1Count?t.msg1Count:0),t.$store.commit("SET_SHARED_COUNT",e.result.collaborate?e.result.collaborate:0))})).catch((function(e){t.$logger.error("系统消息通知异常",e),t.stopTimer=!0,t.$logger.error("清理timer")}))},handleToSettings:function(){this.$router.push({path:"/account/settings"})},handleToAccounts:function(){this.$router.push({path:"/account/info"})},handleToNotification:function(){this.$router.push({path:"/notification"})},handleLogout:function(t){var e=this;n["a"].confirm({title:this.$t("layouts.usermenu.dialog.title"),content:this.$t("layouts.usermenu.dialog.content"),onOk:function(){var t="CURICULUM_SET_".concat(e.userMode,"_").concat(e.currentSchool.id,"_").concat(e.info.id);return e.$store.dispatch("Logout").then((function(){sessionStorage.removeItem(t),e.$router.push({name:"login"})}))},onCancel:function(){}})},handleChangePersonal:function(){var t=this;Object(c["c"])({isPersonal:!0,schoolId:""}).finally((function(){t[l["M"]](u["Y"].SELF),t.GetClassList(),t.$router.replace("/teacher/main/created-by-me"),t.$store.dispatch("GetInfo").then((function(e){t.hasSetCurriculum()}))}))},handleChangeSchool:function(t){var e=this,s=this.userMode;Object(c["c"])({isPersonal:!1,schoolId:t.id}).then((function(a){e[l["M"]](u["Y"].SCHOOL),e.GetClassList(t.id),s===u["Y"].SELF&&e.$router.replace("/teacher/main/created-by-me"),e.$store.dispatch("GetInfo").then((function(t){e.hasSetCurriculum()}))}))},hasSetCurriculum:function(){var t=this;Object(f["a"])({schoolId:this.currentSchool.id}).then((function(e){0===e.code&&(e.result&&e.result.length>0?0===e.result[0].gradeSettingInfo.length&&t.doConfirmGoCuriculum():t.doConfirmGoCuriculum())}))},doConfirmGoCuriculum:function(){var t=this;if(this.userMode===u["Y"].SCHOOL){var e=this.currentSchool.roleNames.includes("Admin");if(!e)return}var s="CURICULUM_SET_".concat(this.userMode,"_").concat(this.currentSchool.id,"_").concat(this.info.id),a=sessionStorage.getItem(s);a||this.$confirm({title:"Curriculum Set",content:"Please Set Curriculum first",centered:!0,cancelButtonProps:{style:{display:"none"}},onOk:function(){sessionStorage.setItem(s,1),t.$router.push("/manage/curriculum")},onCancel:function(){}})},hasRolePermission:function(t){var e=!1;if(this.userMode===u["Y"].SCHOOL&&this.currentSchool.roleNames){var s=this.currentSchool.roleNames.map((function(t){return t.toLowerCase()}));e=s.includes(t)}return e}})},v=m,p=(s("d5ed"),s("0c7c")),g=Object(p["a"])(v,a,i,!1,null,"3bb614fc",null);e["a"]=g.exports},"682b":function(t,e,s){},9774:function(t,e,s){"use strict";s("a730")},a730:function(t,e,s){},c44c:function(t,e,s){var a=s("b2b7");t.exports={__esModule:!0,default:a.svgComponent({tag:"svg",attrsMap:{t:"1651919287086",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3862","xmlns:xlink":"http://www.w3.org/1999/xlink",width:"48",height:"48"},children:[{tag:"defs"},{tag:"path",attrsMap:{d:"M1011.699621 955.59682l-299.842879-300.13541a400.32681 400.32681 0 1 0-56.555731 56.75075l299.84288 300.086654a39.686521 39.686521 0 0 0 28.277865 11.701186 41.636719 41.636719 0 0 0 28.765415-11.701186 39.784031 39.784031 0 0 0-0.48755-56.701994zM80.480272 401.594439a320.807504 320.807504 0 1 1 320.807503 321.148788 321.295053 321.295053 0 0 1-320.807503-321.343808z","p-id":"3863"}}]})}},cd3e:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"global-search-input"},[s("div",{staticClass:"search-icon"},[s("a-icon",{attrs:{type:"search"},nativeOn:{click:function(e){return t.activeSearchInput.apply(null,arguments)}}})],1),s("div",{directives:[{name:"show",rawName:"v-show",value:t.showSearchWrapper,expression:"showSearchWrapper"}],staticClass:"global-search"},[s("div",{staticClass:"search-input-line"},[s("div",{staticClass:"search-back"},[s("a-icon",{style:{color:"#999",fontSize:"16px"},attrs:{type:"arrow-left"},on:{click:t.handleBack}})],1),s("div",{staticClass:"search-input"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.searchKeyword,expression:"searchKeyword"}],attrs:{autocomplete:"off",id:"search-input",placeholder:"Search..."},domProps:{value:t.searchKeyword},on:{keyup:[t.handleSearch,function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.emitSearchEvent(t.searchKeyword)}],input:function(e){e.target.composing||(t.searchKeyword=e.target.value)}}})]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.searchKeyword.length>0,expression:"searchKeyword.length > 0"}],staticClass:"search-clear",on:{click:t.handleSearchClear}},[s("a-icon",{attrs:{type:"close"}})],1)]),s("div",{staticClass:"search-recommend-list"},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.searchKeyword,expression:"searchKeyword"}],staticClass:"do-search",on:{click:function(e){return t.emitSearchEvent(t.searchKeyword)}}},[s("div",{staticClass:"icon"},[s("a-icon",{style:{color:"#999",fontSize:"16px"},attrs:{type:"search"}})],1),s("div",{staticClass:"search-content-left"},[t._v(' Search "'),s("span",{staticClass:"bold"},[t._v(t._s(t.searchKeyword))]),t._v('" ')])]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.showSearchHistory,expression:"showSearchHistory"}],staticClass:"search-history"},t._l(t.historyList,(function(e){return s("div",{key:e,staticClass:"list-item",on:{click:function(s){return t.emitSearchEvent(e)}}},[s("div",{staticClass:"icon"},[s("a-icon",{style:{color:"#999",fontSize:"16px"},attrs:{type:"clock-circle",theme:"filled"}})],1),s("div",{staticClass:"search-content"},[t._v(" "+t._s(e)+" ")])])})),0),s("div",{directives:[{name:"show",rawName:"v-show",value:t.showSearchRecommend,expression:"showSearchRecommend"}],staticClass:"recommend-list"},[t._l(t.similarList,(function(e,a){return s("div",{key:a,staticClass:"list-item",on:{click:function(s){return t.emitSearchEvent(e.name)}}},[s("div",{staticClass:"icon similar-icon"},[t._v(" # ")]),s("div",{staticClass:"search-content"},[s("div",{staticClass:"content-name"},[t._v(" "+t._s(e.name)+" ")])])])})),t._l(t.pdList,(function(e){return s("div",{key:e.id,staticClass:"list-item",on:{click:function(s){return t.viewItem(e)}}},[t._m(0,!0),s("div",{staticClass:"search-content"},[s("div",{staticClass:"content-name"},[t._v(" "+t._s(e.name)+" ")])])])})),t._l(t.planList,(function(e){return s("div",{key:e.id,staticClass:"list-item",on:{click:function(s){return t.viewItem(e)}}},[t._m(1,!0),s("div",{staticClass:"search-content"},[s("div",{staticClass:"content-name"},[t._v(" "+t._s(e.name)+" ")])])])})),t._l(t.taskList,(function(e){return s("div",{key:e.id,staticClass:"list-item",on:{click:function(s){return t.viewItem(e)}}},[t._m(2,!0),s("div",{staticClass:"search-content"},[s("div",{staticClass:"content-name"},[t._v(" "+t._s(e.name)+" ")])])])}))],2),t.searching?s("div",{staticClass:"searching"},[s("a-spin",[s("a-icon",{staticStyle:{"font-size":"24px"},attrs:{slot:"indicator",type:"loading",spin:"",tip:"searching..."},slot:"indicator"})],1)],1):t._e()]),s("div",{staticClass:"bg-mask",on:{click:t.handleBack}})]),t.previewVisible?s("content-preview",{attrs:{"content-id":t.previewCurrentId,"content-type":t.previewType},on:{close:t.handlePreviewClose}}):t._e()],1)},i=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"icon"},[s("div",{staticClass:"tag-icon"},[t._v("PD")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"icon"},[s("div",{staticClass:"tag-icon"},[t._v("Unit")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"icon"},[s("div",{staticClass:"tag-icon"},[t._v("Task")])])}],n=s("5530"),r=(s("498a"),s("a434"),s("fb6a"),s("ac1f"),s("841c"),s("d3b7"),s("159b"),s("b0c0"),s("99af"),s("c44c")),o=s.n(r),c=s("85b1"),l=s("1778"),u=s("ce85"),h=s("f031"),d={name:"GlobalSearchInput",components:{ContentPreview:u["a"],SearchIcon:o.a},mixins:[h["a"]],data:function(){return{data:null,searchKeyword:"",showSearchWrapper:!1,searching:!1,handleSearch:null,pdList:[],planList:[],similarList:[],taskList:[],historyList:[]}},props:{schoolId:{type:String,default:"0"},source:{type:String,default:"library"}},computed:{showSearchHistory:function(){return null===this.searchKeyword||""===this.searchKeyword.trim()},showSearchRecommend:function(){return this.searchKeyword}},created:function(){this.handleSearch=Object(c["a"])(this.doSearch,300),this.restoreSearchKey()},methods:{storeSearchKey:function(){var t=this.$store.getters.userInfo.id;window.sessionStorage.setItem("".concat(t,"_search_key_list"),JSON.stringify(this.historyList))},restoreSearchKey:function(){var t=this.$store.getters.userInfo.id,e=window.sessionStorage.getItem("".concat(t,"_search_key_list"));this.historyList=e?JSON.parse(e):[]},handleSearchClear:function(){this.searchKeyword="",this.recommendList=[]},handleBack:function(){this.$logger.info("handleBack"),this.showSearchWrapper=!1},doSearch:function(){var t=this.searchKeyword.trim();if(t){var e=this.historyList.indexOf(t);-1!==e&&this.historyList.splice(e,1),this.historyList.unshift(t),this.historyList.length>5&&(this.historyList=this.historyList.slice(0,5)),this.storeSearchKey(),this.search(t)}},search:function(t){var e=this;this.$logger.info("search",t),this.searching=!0,this.recommendList=[],this.pdList=[],this.planList=[],this.taskList=[],this.similarList=[],Object(l["d"])({key:t,schoolId:this.schoolId}).then((function(s){e.$logger.info("searchByKeyword "+t,s);var a=[],i=s.result.similarList;e.pdList=s.result.pdList,e.planList=s.result.planList,e.taskList=s.result.taskList,i.forEach((function(e){if(e.name&&!a.some((function(t){return t.name===e.name}))){var s=0,i=e.name.toLowerCase().indexOf(t),n="";while(-1!==i&&i+t.length<=e.name.length)n+=e.name.substring(s,i)+'<span class="search-keyword-item">'+e.name.substring(i,i+t.length)+"</span>",s=i+t.length,i=e.name.toLowerCase().indexOf(t,i+t.length);n+=e.name.substring(s);var r={fromType:e.fromType,name:e.name,tagName:n,id:e.id};a.push(r)}})),e.similarList=i})).finally((function(){e.searching=!1}))},activeSearchInput:function(){this.showSearchWrapper=!0,this.$nextTick((function(){document.getElementById("search-input").focus()}))},emitSearchEvent:function(t){this.$logger.info("emitSearchEvent",t),this.$emit("search",t),this.handleBack()},viewItem:function(t){this.$logger.info("viewItem",t);var e=Object(n["a"])(Object(n["a"])({},t),{},{type:parseInt(t.fromType)});this.$logger.info("dataItem",t),this.showSearchWrapper=!1,this.$router.push({path:"/teacher/".concat(this.source,"-view/").concat(e.type,"/").concat(e.id)})}}},f=d,m=(s("9774"),s("0c7c")),v=Object(m["a"])(f,a,i,!1,null,"d3f54b0c",null);e["a"]=v.exports},d5ed:function(t,e,s){"use strict";s("682b")}}]);