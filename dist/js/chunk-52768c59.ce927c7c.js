(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-52768c59"],{"0fac":function(e,t,a){"use strict";a.d(t,"a",(function(){return c}));var o=a("85b1"),r=a("ca00"),s=a("8ded"),n=a.n(s),c={data:function(){return{saving:!1,saveTime:null,asyncSaveLocalDataFn:null,asyncSaveDataFn:null,autoSaveLocalKey:"FORM_",needAutoSave:!1,needAutoSaveRemote:!1}},created:function(){this.asyncSaveLocalDataFn=Object(o["a"])(this.autoSaveLocalData,200),this.asyncSaveDataFn=Object(o["a"])(this.autoSaveData,1e3)},watch:{formModel:{deep:!0,handler:function(e,t){this.needAutoSave&&this.asyncSaveLocalDataFn(e),this.needAutoSaveRemote&&!this.loading&&this.asyncSaveDataFn(e)}}},computed:{lastChangeSavedTime:function(){var e=this.saveTime||this.formModel&&(this.formModel.updateTime||this.form.createTime);return e?Object(r["formatLocalUTC"])(e):""}},methods:{autoSaveLocalData:function(e){var t=this.$store.getters.userInfo.id,a=this.$store.state.user.currentSchool.id;n.a.set(this.autoSaveLocalKey+t+a,JSON.stringify(e)),this.saveTime=new Date},autoSaveData:function(e){var t=this;this.handleSave((function(){t.saveTime=new Date}))},getAutoLocalData:function(){var e=this.$store.getters.userInfo.id,t=this.$store.state.user.currentSchool.id,a=n.a.get(this.autoSaveLocalKey+e+t);return a?JSON.parse(a):{}},clearLocalData:function(){var e=this.$store.getters.userInfo.id,t=this.$store.state.user.currentSchool.id;n.a.remove(this.autoSaveLocalKey+e+t)}}}},"0fb1":function(e,t,a){},"178d":function(e,t,a){},"21fb":function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));a("b0c0");var o={data:function(){return{unwatch:null,routeName:this.$route.name}},created:function(){var e=this;this.unwatch=this.$store.watch((function(e){return e.user.currentSchool}),(function(t){return t&&e.$route.name===e.routeName&&e.handleSchoolChange(t)}))},computed:{},beforeDestroy:function(){this.unwatch&&this.unwatch()},methods:{handleSchoolChange:function(e){}}}},"28aa":function(e,t,a){},"34f4":function(e,t,a){"use strict";a("28aa")},"37bc":function(e,t,a){"use strict";a("0fb1")},4992:function(e,t,a){e.exports=a.p+"img/default-avatar.db1c5445.png"},"4c77":function(e,t,a){"use strict";a("178d")},"6d78":function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));a("4de4"),a("07ac"),a("b64b");var o=a("8ded"),r=a.n(o),s={data:function(){return{validateFileds:{},refName:"form"}},computed:{hasErrors:function(){return Object.values(this.validateFileds).filter((function(e){return!e})).length>0}},methods:{initValidate:function(e){var t=this;!e&&this.validatorRules&&this.$refs[this.refName].validateField(Object.keys(this.validatorRules),(function(e){var a=t.$store.getters.userInfo.id,o=t.autoSaveLocalKey?r.a.get(t.autoSaveLocalKey+a):"";o||t.$refs[t.refName].clearValidate()}))},fillValidate:function(e,t){this.$set(this.validateFileds,e,t)}}}},"6e84":function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));a("b0c0");var o={data:function(){return{unwatch:null,routeName:this.$route.name}},computed:{redirectUrl:function(){return"student"===this.$store.state.user.currentRole?"/student/main/my-task":"/account/info"}},created:function(){var e=this;this.unwatch=this.$store.watch((function(e){return e.app.userMode}),(function(t){t&&e.$route.name===e.routeName&&(e.handleModeChange(t),e.routeInMode())})),this.routeInMode()},beforeDestroy:function(){this.unwatch&&this.unwatch()},methods:{routeInMode:function(){this.$route.meta.mode&&this.$route.meta.mode!==this.$store.state.app.userMode&&this.$router.push({path:this.redirectUrl})},handleModeChange:function(e){}}}},"6f2a":function(e,t,a){"use strict";a.d(t,"g",(function(){return n})),a.d(t,"h",(function(){return c})),a.d(t,"e",(function(){return i})),a.d(t,"b",(function(){return l})),a.d(t,"a",(function(){return d})),a.d(t,"f",(function(){return u})),a.d(t,"d",(function(){return f})),a.d(t,"i",(function(){return h})),a.d(t,"c",(function(){return m}));a("d3b7");var o=a("b775"),r="api2/school/role",s={listRole:"/classcipe/".concat(r,"/list"),pageListRole:"/classcipe/".concat(r,"/pageList"),getRolePermission:"/classcipe/".concat(r,"/getPermission"),bindRoleSubjectLeader:"/classcipe/".concat(r,"/user/bindSubjectLeader"),bindRoleClassTeachers:"/classcipe/".concat(r,"/user/bindTeachers"),getRoleSubjectLeaders:"/classcipe/".concat(r,"/user/getSubjectLeaders"),getRoleClassTeachers:"/classcipe/".concat(r,"/user/getTeachers"),getSchoolRole:"/classcipe/".concat(r,"/user/getSchoolRole"),saveSchoolRole:"/classcipe/".concat(r,"/user/saveSchoolRole"),geHeaderClassByUserId:"/classcipe/".concat(r,"/user/geHeaderClassByUserId")};function n(e){return Object(o["d"])({url:s.getSchoolRole,method:"get",params:e}).then((function(e){var t=e;if(0===t.code){var a=[];for(var o in t.result.roleNames)"Teacher"!==o&&a.push({roleCode:o,name:t.result.roleNames[o]});t.result=a}return Promise.resolve(t)})).catch((function(e){return Promise.reject(e)}))}function c(e){return Object(o["d"])({url:s.getSchoolRole,method:"get",params:e}).then((function(e){var t=e;if(0===t.code){var a=[];for(var o in t.result.roleNames)"Teacher"!==o&&a.push({roleCode:o,name:t.result.roleNames[o]});t.result={total:a.length,records:a}}return Promise.resolve(t)})).catch((function(e){return Promise.reject(e)}))}function i(e){return Object(o["d"])({url:s.getRolePermission,method:"get",params:e})}function l(e){return Object(o["d"])({url:s.bindRoleSubjectLeader,method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function d(e){return Object(o["d"])({url:s.bindRoleClassTeachers,method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function u(e){return Object(o["d"])({url:s.getRoleSubjectLeaders,method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function f(e){return Object(o["d"])({url:s.getRoleClassTeachers,method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function h(e){return Object(o["d"])({url:s.saveSchoolRole,method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function m(e){return Object(o["d"])({url:s.geHeaderClassByUserId,method:"get",params:e})}},"8d90":function(e,t,a){"use strict";var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-modal",{attrs:{title:e.$t("account.settings.avatar.edit"),visible:e.visible,maskClosable:!1,confirmLoading:e.confirmLoading,width:800,footer:null},on:{cancel:e.cancelHandel}},[a("a-row",[a("a-col",{style:{height:"350px"},attrs:{xs:24,md:12}},[a("vue-cropper",{ref:"cropper",attrs:{img:e.options.img,info:!0,autoCrop:e.options.autoCrop,autoCropWidth:e.options.autoCropWidth,autoCropHeight:e.options.autoCropHeight,fixedBox:e.options.fixedBox},on:{realTime:e.realTime}})],1),a("a-col",{style:{height:"350px"},attrs:{xs:24,md:12}},[a("div",{staticClass:"avatar-upload-preview"},[a("img",{style:e.previews.img,attrs:{src:e.previews.url}})])])],1),a("br"),a("a-row",[a("a-col",{attrs:{lg:2,md:2}},[a("a-upload",{attrs:{name:"file",beforeUpload:e.beforeUpload,showUploadList:!1}},[a("a-button",{attrs:{icon:"upload"}},[e._v(e._s(e.$t("account.settings.avatar.select-image")))])],1)],1),a("a-col",{attrs:{lg:{span:1,offset:2},md:2}},[a("a-button",{attrs:{icon:"plus"},on:{click:function(t){return e.changeScale(1)}}})],1),a("a-col",{attrs:{lg:{span:1,offset:1},md:2}},[a("a-button",{attrs:{icon:"minus"},on:{click:function(t){return e.changeScale(-1)}}})],1),a("a-col",{attrs:{lg:{span:1,offset:1},md:2}},[a("a-button",{attrs:{icon:"undo"},on:{click:e.rotateLeft}})],1),a("a-col",{attrs:{lg:{span:1,offset:1},md:2}},[a("a-button",{attrs:{icon:"redo"},on:{click:e.rotateRight}})],1),a("a-col",{attrs:{lg:{span:4,offset:6},md:4}},[a("a-space",[a("a-button",{on:{click:e.close}},[e._v(" Cancel ")]),a("a-button",{attrs:{type:"primary",disabled:e.confirmLoading,loading:e.confirmLoading},on:{click:e.uploadImage}},[e._v("Save")])],1)],1)],1)],1)},r=[],s=(a("ac1f"),a("1276"),a("466d"),a("ace4"),a("d3b7"),a("5cc6"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("d5d6"),a("82f8"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("170b"),a("b39a"),a("72f7"),a("99af"),a("fb6a"),a("25f0"),a("d0d0")),n={data:function(){return{visible:!1,id:null,confirmLoading:!1,fileList:[],uploading:!1,options:{img:"",autoCrop:!0,autoCropWidth:200,autoCropHeight:200,fixedBox:!0},previews:{}}},methods:{edit:function(e){this.visible=!0,this.id=e},close:function(){this.id=null,this.visible=!1},cancelHandel:function(){this.close()},changeScale:function(e){e=e||1,this.$refs.cropper.changeScale(e)},rotateLeft:function(){this.$refs.cropper.rotateLeft()},rotateRight:function(){this.$refs.cropper.rotateRight()},beforeUpload:function(e){var t=this,a=new FileReader;return a.readAsDataURL(e),a.onload=function(){t.options.img=a.result},!1},uploadImage:function(){var e=this;this.$refs.cropper.getCropData((function(t){var a=t.split(","),o=a[0].match(/:(.*?);/)[1],r=atob(a[1]),n=r.length,c=new Uint8Array(n);while(n--)c[n]=r.charCodeAt(n);e.model=!0,e.modelSrc=t;var i=o.split("/")[1],l=new File([c],"custom_image_".concat(Date.now(),"_").concat(Math.random().toString(36).slice(2),".").concat(i),{type:o});e.$logger.info("upload file",l),e.confirmLoading=!0,Object(s["a"])(e.$store.getters.userInfo.id,l,e.getProgressUpLoad,(function(t){e.onSuccess(l,t)}),!0)}))},getProgressUpLoad:function(e){this.$logger.info("getProgressUpLoad",e),this.confirmLoading=!0},onSuccess:function(e,t){this.$logger.info("upload success",e,t),this.$emit("ok",t),this.confirmLoading=!1,this.okHandel()},okHandel:function(){var e=this;e.confirmLoading=!0,setTimeout((function(){e.confirmLoading=!1,e.close(),e.$message.success("update avatar successfully!")}),2e3)},realTime:function(e){this.previews=e}}},c=n,i=(a("4c77"),a("0c7c")),l=Object(i["a"])(c,o,r,!1,null,"06163b63",null);t["a"]=l.exports},e052:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"my-full-form-wrapper",attrs:{id:"formRoot"}},[o("fixed-form-header",{scopedSlots:e._u([{key:"header",fn:function(){return[o("form-header",{attrs:{title:e.title,"show-share":!1,"show-collaborate":!1,"is-preview-mode":!0},on:{back:e.goBack},scopedSlots:e._u([{key:"back",fn:function(){return[o("img",{staticClass:"single-logo-img",attrs:{src:a("be50"),alt:"classcipe"},on:{click:function(t){return t.stopPropagation(),e.$router.push("/")}}})]},proxy:!0},{key:"left",fn:function(){return[o("a-space",{attrs:{size:5,align:"center"},on:{click:function(e){e.stopPropagation()}}},[o("label",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.$router.push("/account/info")}}},[e._v("Account Info")]),o("label",{attrs:{for:""}},[e._v(">")]),e.onlyClass?[o("label",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.$router.push("/manage/class/list")}}},[e._v("School Class")]),o("label",{attrs:{for:""}},[e._v(">")]),o("label",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.$router.push("/manage/teacher/list?classId="+e.onlyClass.id)}}},[e._v(e._s(e.onlyClass.name))]),o("label",{attrs:{for:""}},[e._v(">")])]:[o("label",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.$router.push("/manage/teacher/list")}}},[e._v("School Teacher")]),o("label",{attrs:{for:""}},[e._v(">")])],o("label",{staticStyle:{"font-weight":"normal"}},[e._v(e._s(e.title))])],2)]},proxy:!0},{key:"right",fn:function(){},proxy:!0}])})]},proxy:!0}])}),o("div",{staticClass:"form-content"},[o("school-teacher-add",{ref:"schoolTeacherAdd",attrs:{school:e.currentSchool,id:e.id},on:{getCls:e.changeCls,save:e.handleSave}})],1)],1)},r=[],s=a("5530"),n=a("f93e"),c=a("6e84"),i=a("21fb"),l=a("b5ff8"),d=a("b5a9"),u=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[e.teacherId?o("div",{staticClass:"account-info-self"},[o("div",{staticClass:"info-self-avatar"},[e.formModel.avatar?o("img",{attrs:{src:e.formModel.avatar}}):o("img",{attrs:{src:a("4992")}}),o("a-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.$refs.avatarModal.edit(1)}}},[e._v("Upload")])],1)]):e._e(),o("a-form-model",e._b({ref:"form",attrs:{layout:"horizontal",model:e.formModel,rules:e.validatorRules},on:{validate:e.doValidate}},"a-form-model",e.formItemLayout,!1),[e.teacherId&&e.userMode===e.USER_MODE.SCHOOL?o("a-form-model-item",{attrs:{label:"Last Login",wrapperCol:{span:18}}},[o("a-row",{attrs:{gutter:0}},[o("a-col",{attrs:{span:16}},[e.origin.lastLogin?o("label",{attrs:{for:""}},[e._v(e._s(e._f("dayjs")(e.origin.lastLogin)))]):o("label",{attrs:{for:""}},[e._v("-")])]),o("a-col",{staticStyle:{"text-align":"center"},attrs:{span:2}}),e.teacherId&&e.formModel.inviteEmail?o("a-col",{staticStyle:{"text-align":"center"},attrs:{span:6}},[o("a-button",{attrs:{type:"black",disabled:e.origin.status===e.SCHOOL_USER_STATUS.ACTIVE.value,loading:e.confirmLoading},on:{click:e.handleReset}},[e._v("Reset Password")])],1):e._e()],1)],1):e._e(),e.teacherId&&e.userMode===e.USER_MODE.SELF?o("a-form-model-item",{attrs:{label:"",wrapperCol:{span:18}}},[o("a-row",{attrs:{gutter:0}},[o("a-col",{attrs:{span:16}}),o("a-col",{staticStyle:{"text-align":"center"},attrs:{span:2}}),e.teacherId&&e.formModel.inviteEmail?o("a-col",{staticStyle:{"text-align":"center"},attrs:{span:6}},[o("a-button",{attrs:{type:"black",disabled:e.origin.status===e.SCHOOL_USER_STATUS.ACTIVE.value,loading:e.confirmLoading},on:{click:e.handleReset}},[e._v("Reset Password")])],1):e._e()],1)],1):e._e(),o("a-form-model-item",{staticClass:"mb0",attrs:{label:"Name",required:!0}},[o("a-row",{attrs:{gutter:16}},[o("a-col",{attrs:{span:12}},[o("a-form-model-item",{attrs:{prop:"firstName",hasFeedback:!0}},[o("a-input",{attrs:{placeholder:"First name"},model:{value:e.formModel.firstName,callback:function(t){e.$set(e.formModel,"firstName",t)},expression:"formModel.firstName"}})],1)],1),o("a-col",{attrs:{span:12}},[o("a-form-model-item",{attrs:{prop:"lastName",hasFeedback:!0}},[o("a-input",{attrs:{placeholder:"Last name"},model:{value:e.formModel.lastName,callback:function(t){e.$set(e.formModel,"lastName",t)},expression:"formModel.lastName"}})],1)],1)],1)],1),o("a-form-model-item",{attrs:{label:"Email",prop:"inviteEmail",hasFeedback:!0}},[o("a-input",{attrs:{disabled:e.teacherId&&!!e.formModel.inviteEmail&&e.origin.status===e.SCHOOL_USER_STATUS.ACTIVE.value,placeholder:"Email"},model:{value:e.formModel.inviteEmail,callback:function(t){e.$set(e.formModel,"inviteEmail",t)},expression:"formModel.inviteEmail"}})],1),o("a-form-model-item",{attrs:{label:"DOB"}},[o("a-date-picker",{attrs:{"disabled-date":e.disabledDate},model:{value:e.formModel.birthDay,callback:function(t){e.$set(e.formModel,"birthDay",t)},expression:"formModel.birthDay"}})],1),e.classUnModify||e.teacherId?o("a-form-model-item",{staticClass:"mb0",attrs:{label:"Class"}},[o("a-row",{attrs:{gutter:16}},[o("a-col",{attrs:{span:18}},[o("a-form-model-item",{staticClass:"self-select"},[e.classUnModify?o("a-space",[e.classArrDetail.length>0?o("a-space",{staticClass:"flex-wrap"},[e._l(e.classArrDetail,(function(t){return[o("a-tag",{key:t.id,attrs:{color:0===t.classType?"#2db7f5":"#f50"}},[e._v(" "+e._s(1===t.classType?e.formatViewName(t.subject)+"-"+t.name:t.name)+" ")])]}))],2):o("label",{attrs:{for:""}},[e._v(" - ")])],1):[o("a-select",{attrs:{mode:"multiple",disabled:e.classUnModify,optionFilterProp:"children",getPopupContainer:function(e){return e.parentElement},"option-label-prop":"label",placeholder:"Please select class"},model:{value:e.formModel.classArr,callback:function(t){e.$set(e.formModel,"classArr",t)},expression:"formModel.classArr"}},e._l(e.filterClassList,(function(t){return o("a-select-option",{key:t.id,attrs:{label:t.name}},[e._v(" "+e._s(t.name)+" ")])})),1),o("div",{ref:"tagRender",staticClass:"tag-render",class:{disabled:e.classUnModify},attrs:{size:4},on:{click:e.showSelect}},e._l(e.formModel.classArr,(function(t){return o("a-tag",{key:"tag"+t,attrs:{closable:e.isShowClose(t),color:e.clsColor(t)},on:{close:function(a){return e.closeCls(t)}}},[e._v(e._s(e.formatName(t,e.classList)))])})),1)]],2)],1),e.showClassLink?o("a-col",{attrs:{span:6}},[o("a-button",{attrs:{type:"link"},on:{click:e.handelGoClass}},[e._v("Class Manage")])],1):e._e()],1)],1):e._e(),e.teacherId?o("a-form-model-item",{attrs:{label:"Roles"}},[e.formModel.roleArr.length>0?o("a-space",e._l(e.formModel.roleArr,(function(t){return o("a-tag",{key:"role_"+t},[e._v(e._s(t))])})),1):o("label",{attrs:{for:""}},[e._v(" - ")])],1):e._e(),o("a-form-model-item",{attrs:{wrapperCol:{offset:6}}},[o("a-button",{attrs:{disabled:e.hasErrors,loading:e.loading,type:"primary"},on:{click:e.handleSave}},[e._v(e._s(e.teacherId?"Update":"Create"))])],1)],1),o("a-modal",{attrs:{destroyOnClose:"",title:"Reset Password",width:"600px",footer:null},model:{value:e.passwordVis,callback:function(t){e.passwordVis=t},expression:"passwordVis"}},[o("reset-password",{attrs:{needOld:!1}})],1),o("avatar-modal",{ref:"avatarModal",on:{ok:e.setAvatar}})],1)},f=[],h=a("3835"),m=(a("4de4"),a("caad"),a("2532"),a("d3b7"),a("3ca3"),a("ddb0"),a("7db0"),a("159b"),a("99af"),a("d81d"),a("a15b"),a("b0c0"),a("fb6a"),a("a630"),a("6062"),a("ac1f"),a("1276"),a("ad59")),p=a("ec09"),b=a("6f2a"),g=a("9bfe"),v=a("f371"),S=a("8d90"),w=a("6d78"),y=a("0fac"),C=a("c1df"),j=a.n(C),T=a("2f62"),O=a("4fcf"),M=O.sortBy,L={name:"SchoolTeacherAdd",components:{ResetPassword:v["a"],AvatarModal:S["a"]},mixins:[w["a"],y["a"],c["a"],i["a"]],props:{id:{type:String,default:null},showClassLink:{type:Boolean,default:!1}},watch:{id:{handler:function(e){this.teacherId=e,this.initForm(),this.initUserClassRole()},immediate:!0}},data:function(){var e;return{SCHOOL_USER_STATUS:n["A"],USER_MODE:n["Y"],sortBy:M,teacherId:this.id,classList:[],roleList:[],formModel:{firstName:"",lastName:"",birthDay:"",classes:"",classArr:[],inviteEmail:"",roles:"",roleArr:[],schoolId:(null===(e=this.school)||void 0===e?void 0:e.id)||"",avatar:""},origin:{},formItemLayout:{labelCol:{span:6},wrapperCol:{span:12}},loading:!1,passwordVis:!1,confirmLoading:!1,cacheKey:"SUBMIT_VALIDATE_SCHOOL_TEACHER_",autoSaveLocalKey:"FORM_SCHOOL_TEACHER_",needAutoSave:!this.id,userHeaderTeacherCls:[],classUnModify:!1,subjectOptions:[]}},computed:Object(s["a"])(Object(s["a"])({},Object(T["e"])({info:function(e){return e.user.info},currentSchool:function(e){return e.user.currentSchool},userMode:function(e){return e.app.userMode}})),{},{validatorRules:function(){return{firstName:[{required:!0,message:"Please Input First Name!"}],lastName:[{required:!0,message:"Please Input Last Name!"}],inviteEmail:[{required:!0,message:"Please Input Email!"},{type:"email",message:"Please Input Valid Email!"},{validator:this.validateRemoteEmail,trigger:"blur"}],classArr:[{required:!0,message:"Please Select a class!",trigger:"change"}],roleArr:[{required:!0,message:"Please Select a role!",trigger:"change"}]}},filterClassList:function(){var e=this;return this.classList.filter((function(t){return!e.formModel.classArr.includes(t.id)}))},classArrDetail:function(){var e=this,t=this.classList.filter((function(t){return e.formModel.classArr.includes(t.id)}));return M(t,"classType")}}),created:function(){this.initData()},methods:{handleSchoolChange:function(e){this.userMode===n["Y"].SCHOOL&&(this.initData(),this.initUserClassRole())},handleModeChange:function(e){this.initData(),this.initUserClassRole()},initData:function(){var e=this;Promise.all([Object(m["g"])({schoolId:this.currentSchool.id,pageNo:1,pageSize:1e4}),Object(b["g"])({schoolId:this.currentSchool.id}),Object(g["a"])({schoolId:this.currentSchool.id})]).then((function(t){var a=Object(h["a"])(t,3),o=a[0],r=a[1],s=a[2];if(0===o.code){e.classList=o.result.records.filter((function(e){return 2!==e.classType})),e.classUnModify=!!e.teacherId;var n=e.$route.query;if(n.classId){var c=e.classList.find((function(e){return e.id===n.classId}));c&&(e.formModel.classArr=[n.classId],e.formModel.classes=n.classId,e.classUnModify=!0,e.$emit("getCls",c))}}if(0===r.code&&(e.roleList=r.result),s.success){var i=[];s.result.forEach((function(e){e.subjectList&&e.subjectList.length>0&&(i=i.concat(e.subjectList))}));var l=[];i.forEach((function(e){l.push({subjectId:e.subjectId,subjectName:e.subjectName}),l.push({subjectId:e.parentSubjectId,subjectName:e.parentSubjectName})})),e.subjectOptions=l}}))},initForm:function(e){var t=this;if(this.teacherId)this.loading=!0,Object(p["p"])({schoolId:this.currentSchool.id,userId:this.teacherId}).then((function(e){if(0===e.code&&(t.origin=Object(s["a"])({},e.result),t.formModel.id=e.result.id,t.formModel.firstName=e.result.firstname,t.formModel.lastName=e.result.lastname,t.formModel.birthDay=e.result.birthday,t.formModel.avatar=e.result.avatar,t.formModel.inviteEmail=e.result.inviteEmail,e.result.classes&&(t.formModel.classArr=e.result.classes.map((function(e){return e.id})),t.formModel.classes=t.formModel.classArr.join(",")),e.result.roles)){var a=e.result.roles.filter((function(e){return"teacher"!==e.name.toLowerCase()})).map((function(e){return e.name.charAt(0).toLowerCase()+e.name.slice(1)}));t.formModel.roleArr=Array.from(new Set(a)).map((function(e){return e.charAt(0).toUpperCase()+e.slice(1)})),t.formModel.roles=t.formModel.roleArr.join(",")}})).finally((function(){t.loading=!1}));else{var a=this.getAutoLocalData();this.formModel=Object(s["a"])(Object(s["a"])(Object(s["a"])({},this.formModel),a),e),this.formModel.classes&&(this.formModel.classArr=this.formModel.classes.split(","))}this.$nextTick((function(){t.initValidate(!!t.id)}))},initUserClassRole:function(){var e=this;Object(b["c"])({schoolId:this.currentSchool.id,userId:this.id}).then((function(t){0===t.code&&(e.userHeaderTeacherCls=t.result.classIdList)}))},doValidate:function(e,t){this.fillValidate(e,t)},validateRemoteEmail:function(e,t,a){return t?this.teacherId&&t===this.origin.inviteEmail?a():void Object(p["k"])({emails:t,schoolId:this.currentSchool.id}).then((function(e){0===e.code&&e.result&&e.result[0].exists?a(new Error("Teacher already exists")):a()})).catch((function(e){a(new Error(e.message))})):a()},setAvatar:function(e){this.formModel.avatar=e},disabledDate:function(e){return e&&e>j()()},handelGoClass:function(){this.$router.push("/manage/class")},handleReset:function(){var e=this;this.$confirm({title:"Confirm Reset Password",content:"Do you want to reset password?",centered:!0,onOk:function(){e.confirmLoading=!0,Object(p["v"])({userIds:[e.teacherId]}).then((function(t){0===t.code&&e.$message.success("Opt Successfully")})).finally((function(){e.confirmLoading=!1}))}})},handleSave:function(){var e=this;this.$refs.form.validate((function(t){if(t){var a=Object(s["a"])({},e.formModel);a.schoolId=e.currentSchool.id,a.classes=a.classArr.join(","),a.roles=a.roleArr.join(","),a.birthDay&&(a.birthday=a.birthDay=j.a.utc(a.birthDay).format("YYYY-MM-DD HH:mm:ss")),e.loading=!0;var o=p["d"];e.teacherId&&(o=p["A"]),o(a).then((function(t){0===t.code&&(e.$message.success("Save successfully"),e.clearLocalData(),e.$emit("save",a))})).finally((function(){e.loading=!1}))}}))},formatName:function(e,t){var a=t.find((function(t){return t.id===e}));return a?a.name:""},isShowClose:function(e){return!this.userHeaderTeacherCls.includes(e)&&!this.classUnModify},closeCls:function(e){this.formModel.classArr=this.formModel.classArr.filter((function(t){return t!==e}))},clsColor:function(e){return this.userHeaderTeacherCls.includes(e)?"#ef4136":""},showSelect:function(e){this.$refs.tagRender.previousElementSibling.click()},formatViewName:function(e){var t=this.subjectOptions.find((function(t){return t.subjectId===e}));return t?t.subjectName:"Untitle"}}},_=L,I=(a("37bc"),a("0c7c")),A=Object(I["a"])(_,u,f,!1,null,"94d50002",null),k=A.exports,P=a("4fcf"),U=P.debounce,E={name:"SchoolTeacherEdit",mixins:[c["a"],i["a"]],components:{FixedFormHeader:l["a"],FormHeader:d["a"],SchoolTeacherAdd:k},props:{id:{type:String,default:null}},data:function(){return{USER_MODE:n["Y"],SCHOOL_USER_STATUS:n["A"],onlyClass:null}},created:function(){this.debounceLoad=U(this.loadData,300)},computed:Object(s["a"])(Object(s["a"])({},Object(T["e"])({userMode:function(e){return e.app.userMode},currentSchool:function(e){return e.user.currentSchool}})),{},{title:function(){return this.id?"Edit":"Add"}}),methods:{goBack:function(){this.$router.go(-1)},handleSchoolChange:function(e){this.userMode===n["Y"].SCHOOL&&(this.queryParam.schoolId=e.id,this.initDict(),this.debounceInit())},handleModeChange:function(e){this.debounceInit()},loadData:function(){},handleSave:function(e){this.goBack()},changeCls:function(e){this.onlyClass=e}}},$=E,R=(a("34f4"),Object(I["a"])($,o,r,!1,null,"0b398712",null));t["default"]=R.exports},ec09:function(e,t,a){"use strict";a.d(t,"m",(function(){return c})),a.d(t,"c",(function(){return i})),a.d(t,"d",(function(){return l})),a.d(t,"t",(function(){return d})),a.d(t,"u",(function(){return u})),a.d(t,"l",(function(){return f})),a.d(t,"y",(function(){return h})),a.d(t,"A",(function(){return m})),a.d(t,"h",(function(){return p})),a.d(t,"g",(function(){return b})),a.d(t,"a",(function(){return g})),a.d(t,"e",(function(){return v})),a.d(t,"f",(function(){return S})),a.d(t,"n",(function(){return w})),a.d(t,"p",(function(){return y})),a.d(t,"i",(function(){return C})),a.d(t,"j",(function(){return j})),a.d(t,"k",(function(){return T})),a.d(t,"v",(function(){return O})),a.d(t,"r",(function(){return M})),a.d(t,"z",(function(){return L})),a.d(t,"x",(function(){return _})),a.d(t,"s",(function(){return I})),a.d(t,"w",(function(){return A})),a.d(t,"b",(function(){return k})),a.d(t,"o",(function(){return P})),a.d(t,"q",(function(){return U}));var o=a("b775"),r=a("ca00"),s="api2/school/user",n={getSchoolUsers:"/classcipe/".concat(s,"/getSchoolUsers"),addStudents:"/classcipe/".concat(s,"/addStudents"),addTeacher:"/classcipe/".concat(s,"/addTeacher"),removeStudents:"/classcipe/".concat(s,"/removeStudents"),removeTeachers:"/classcipe/".concat(s,"/removeTeachers"),updateTeacher:"/classcipe/".concat(s,"/updateTeacher"),getInvite:"/classcipe/".concat(s,"/getInvite"),updateInvite:"/classcipe/".concat(s,"/updateInvite"),bulkActTeacher:"/classcipe/".concat(s,"/teacher/bulkAct"),bulkActStudent:"/classcipe/".concat(s,"/student/bulkAct"),acceptInvite:"/classcipe/".concat(s,"/acceptInvite"),batchAddStudent:"/classcipe/".concat(s,"/batchAddStudent"),batchAddTeacher:"/classcipe/".concat(s,"/batchAddTeacher"),getStudentInfo:"/classcipe/".concat(s,"/getStudentInfo"),getTeacherInfo:"/classcipe/".concat(s,"/getTeacherInfo"),checkEmailParent:"/classcipe/".concat(s,"/parent/checkEmail"),resetPassword:"/classcipe/".concat(s,"/resetPassword"),checkEmailStudent:"/classcipe/".concat(s,"/student/checkEmail"),moveClassStudent:"/classcipe/".concat(s,"/student/moveClass"),sendParentEmail:"/classcipe/".concat(s,"/student/sendParentEmail"),checkEmailTeacher:"/classcipe/".concat(s,"/teacher/checkEmail"),updateStudent:"/classcipe/".concat(s,"/updateStudent"),addAdmin:"/classcipe/".concat(s,"/addAdmin"),removeAdmins:"/classcipe/".concat(s,"/removeAdmins"),resetUserPassword:"/classcipe/".concat(s,"/user/resetPassword"),addSchoolAdmin:"/classcipe/".concat(s,"/addSchoolAdmin"),getTeacherCount:"/classcipe/".concat(s,"/getTeacherCount"),listStudents:"/classcipe/".concat(s,"/list/students")};function c(e){return Object(o["d"])({url:n.getSchoolUsers,method:"get",params:e})}function i(e){return e=Object(r["trimParams"])(e),Object(o["d"])({url:n.addStudents,method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function l(e){return e=Object(r["trimParams"])(e),Object(o["d"])({url:n.addTeacher,method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function d(e){return Object(o["d"])({url:n.removeStudents,method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function u(e){return Object(o["d"])({url:n.removeTeachers,method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function f(e){return Object(o["d"])({url:n.getInvite,method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function h(e){return e=Object(r["trimParams"])(e),Object(o["d"])({url:n.updateInvite,method:"post",data:e,params:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function m(e){return e=Object(r["trimParams"])(e),Object(o["d"])({url:n.updateTeacher,method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function p(e){return Object(o["d"])({url:n.bulkActTeacher,method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function b(e){return Object(o["d"])({url:n.bulkActStudent,method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function g(e){return Object(o["d"])({url:n.acceptInvite,method:"post",data:e,params:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function v(e){return e=Object(r["trimParams"])(e),Object(o["d"])({url:n.batchAddStudent,method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function S(e){return e=Object(r["trimParams"])(e),Object(o["d"])({url:n.batchAddTeacher,method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function w(e){return Object(o["d"])({url:n.getStudentInfo,method:"get",params:e})}function y(e){return Object(o["d"])({url:n.getTeacherInfo,method:"get",params:e})}function C(e){return Object(o["d"])({url:n.checkEmailParent,method:"get",params:e})}function j(e){return Object(o["d"])({url:n.checkEmailStudent,method:"get",params:e})}function T(e){return Object(o["d"])({url:n.checkEmailTeacher,method:"get",params:e})}function O(e){return Object(o["d"])({url:n.resetPassword,method:"get",params:e})}function M(e){return Object(o["d"])({url:n.moveClassStudent,method:"get",params:e})}function L(e){return e=Object(r["trimParams"])(e),Object(o["d"])({url:n.updateStudent,method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function _(e){return Object(o["d"])({url:n.sendParentEmail,method:"get",params:e})}function I(e){return Object(o["d"])({url:n.removeAdmins,method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function A(e){return Object(o["d"])({url:n.resetUserPassword,method:"get",params:e})}function k(e){return e=Object(r["trimParams"])(e),Object(o["d"])({url:n.addSchoolAdmin,method:"post",data:e,params:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function P(e){return Object(o["d"])({url:n.getTeacherCount,method:"get",params:e})}function U(e){return Object(o["d"])({url:n.listStudents,method:"get",params:e})}},f371:function(e,t,a){"use strict";var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-form-model",e._b({ref:"form",attrs:{layout:"horizontal",model:e.formModel,rules:e.validatorRules}},"a-form-model",e.formItemLayout,!1),[e.needOld?a("a-form-model-item",{attrs:{label:"Old Password",prop:"password"}},[a("a-input-password",{attrs:{autocomplete:"off",required:!0,type:"password",placeholder:"input password"},model:{value:e.formModel.password,callback:function(t){e.$set(e.formModel,"password",t)},expression:"formModel.password"}})],1):e._e(),a("a-form-model-item",{attrs:{label:"New Password",prop:"newPassword"}},[a("a-input-password",{attrs:{autocomplete:"off",type:"password",placeholder:"input password"},model:{value:e.formModel.newPassword,callback:function(t){e.$set(e.formModel,"newPassword",t)},expression:"formModel.newPassword"}})],1),a("a-form-model-item",{attrs:{label:"Confirm Password",prop:"confirmPassword"}},[a("a-input-password",{attrs:{autocomplete:"off",type:"password",placeholder:"input password"},model:{value:e.formModel.confirmPassword,callback:function(t){e.$set(e.formModel,"confirmPassword",t)},expression:"formModel.confirmPassword"}})],1),a("a-form-model-item",{attrs:{wrapperCol:{offset:6,span:12},label:""}},[a("a-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.handleSave}},[e._v("update")])],1)],1)},r=[],s=(a("d3b7"),a("7ded")),n={name:"ResetPassword",props:{needOld:{type:Boolean,default:!0},saveFn:{type:Function,default:null}},data:function(){var e=this,t=/^(?=.*[a-zA-Z])(?=.*[0-9])[^]{8,}$/,a=function(e,t,a){if(!t)return a(new Error("Please input the password"));Object(s["b"])({password:t}).then((function(e){"Success"!==e.result?a(new Error("Incorrect password")):a()}))},o=function(a,o,r){""===o?r(new Error("Please input the password")):t.test(o)?(""!==e.formModel.confirmPassword&&e.$refs.form.validateField("confirmPassword"),r()):r(new Error("The password must be a combination of letters and numbers, and it must be 8 characters or more."))},r=function(t,a,o){""===a?o(new Error("Please input the password again")):a!==e.formModel.newPassword?o(new Error("Passwords did not match!")):o()};return{formModel:{password:"",newPassword:"",confirmPassword:""},formItemLayout:{labelCol:{span:6},wrapperCol:{span:18}},validatorRules:{password:[{required:!0,trigger:"change",message:"Please input the password"},{validator:a,trigger:"blur"}],newPassword:[{validator:o,trigger:"change"}],confirmPassword:[{validator:r,trigger:"change"}]},loading:!1}},methods:{handleSave:function(){var e=this;this.$refs.form.validate((function(t){t&&(e.loading=!0,e.saveFn?e.saveFn({newPassword:e.formModel.newPassword,oldPassword:e.formModel.password}).then((function(t){0===t.code&&e.$message.success("Update password successfully")})).finally((function(){e.loading=!1})):Object(s["a"])({newPassword:e.formModel.newPassword,oldPassword:e.formModel.password}).then((function(t){0===t.code&&e.$message.success("Update password successfully")})).finally((function(){e.loading=!1})))}))}}},c=n,i=a("0c7c"),l=Object(i["a"])(c,o,r,!1,null,"f6bcd576",null);t["a"]=l.exports}}]);