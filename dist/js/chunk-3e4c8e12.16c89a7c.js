(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3e4c8e12","chunk-8537801c","chunk-597beea5"],{"0381":function(t,e,i){"use strict";var c=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:{"disabled-button":t.disabled,"cc-custom-button":!t.disabled},style:{"background-color":t.bgColor,color:t.color},on:{click:t.handleClick,dblclick:t.handleDbClick}},[t.disabled&&t.disabledTooltip?[i("a-tooltip",{attrs:{title:t.disabledTooltip,placement:t.placement}},[t.loading?i("div",{staticClass:"loading vertical-center"},[i("a-spin",[i("a-icon",{staticStyle:{"font-size":"14px",color:"#666666"},attrs:{slot:"indicator",type:"loading",spin:""},slot:"indicator"})],1)],1):t._e(),i("div",{staticClass:"icon"},[t._t("icon")],2),i("div",{staticClass:"label"},[t._v(" "+t._s(t.label)+" ")])])]:[t.loading?i("div",{staticClass:"loading vertical-center"},[i("a-spin",[i("a-icon",{staticStyle:{"font-size":"14px",color:"#666666"},attrs:{slot:"indicator",type:"loading",spin:""},slot:"indicator"})],1)],1):t._e(),i("div",{staticClass:"icon"},[t._t("icon")],2),i("div",{staticClass:"label"},[t._v(" "+t._s(t.label)+" ")])]],2)},s=[],r={name:"CustomButton",props:{label:{type:String,default:""},bgColor:{type:String,default:"#EEF1F3"},color:{type:String,default:"#16274A"},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},disabledTooltip:{type:String,default:""},placement:{type:String,default:"top"}},methods:{handleClick:function(){this.disabled||this.$emit("click")},handleDbClick:function(){this.disabled||this.$emit("dblclick")}}},a=r,n=(i("5d91"),i("0c7c")),u=Object(n["a"])(a,c,s,!1,null,"b546cb6a",null);e["a"]=u.exports},"11f0":function(t,e,i){t.exports=i.p+"img/no-subject.e2d87663.png"},1202:function(t,e,i){},"12a0":function(t,e,i){},1455:function(t,e,i){},"19d1":function(t,e,i){},"1c62":function(t,e,i){"use strict";i("1455")},"21fb":function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));i("b0c0");var c={data:function(){return{unwatch:null,routeName:this.$route.name}},created:function(){var t=this;this.unwatch=this.$store.watch((function(t){return t.user.currentSchool}),(function(e){return e&&t.$route.name===t.routeName&&t.handleSchoolChange(e)}))},computed:{},beforeDestroy:function(){this.unwatch&&this.unwatch()},methods:{handleSchoolChange:function(t){}}}},4357:function(t,e,i){"use strict";var c=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"link-text",style:{"font-size":t.size+"px","line-height":t.size+"px",color:t.color,cursor:t.disabled?"not-allowed":"pointer"},on:{click:t.handleClick}},[t._t("prefix"),i("div",{staticClass:"text"},[t._v(" "+t._s(t.text)+" ")]),t._t("suffix")],2)},s=[],r=(i("a9e3"),{name:"CustomLinkText",props:{text:{type:String,default:null},color:{type:String,default:"#007A8E"},size:{type:Number,default:14},disabled:{type:Boolean,default:!1}},data:function(){return{}},created:function(){},methods:{handleClick:function(){this.$emit("click")}}}),a=r,n=(i("671b"),i("0c7c")),u=Object(n["a"])(a,c,s,!1,null,"5d459e12",null);e["a"]=u.exports},4826:function(t,e,i){},5113:function(t,e,i){"use strict";i("c2fe")},"5d91":function(t,e,i){"use strict";i("19d1")},"658c":function(t,e,i){"use strict";var c=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cc-custom-button",style:{backgroundColor:t.bgColor,color:t.fontColor},on:{click:t.handleClick,dblclick:t.handleDbClick}},[i("div",{staticClass:"icon"},[t._t("icon")],2),i("div",{staticClass:"label"},[t._v(" "+t._s(t.label)+" ")])])},s=[],r={name:"CustomMediaCoverButton",props:{label:{type:String,default:""},bgColor:{type:String,default:"#EEF1F3"},fontColor:{type:String,default:"#515564"}},methods:{handleClick:function(){this.$emit("click")},handleDbClick:function(){this.$emit("dblclick")}}},a=r,n=(i("6982"),i("0c7c")),u=Object(n["a"])(a,c,s,!1,null,"09140532",null);e["a"]=u.exports},"671b":function(t,e,i){"use strict";i("adbe")},6982:function(t,e,i){"use strict";i("1202")},"6e84":function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));i("b0c0");var c={data:function(){return{unwatch:null,routeName:this.$route.name}},computed:{redirectUrl:function(){return"student"===this.$store.state.user.currentRole?"/student/main/my-task":"/account/info"}},created:function(){var t=this;this.unwatch=this.$store.watch((function(t){return t.app.userMode}),(function(e){e&&t.$route.name===t.routeName&&(t.handleModeChange(e),t.routeInMode())})),this.routeInMode()},beforeDestroy:function(){this.unwatch&&this.unwatch()},methods:{routeInMode:function(){this.$route.meta.mode&&this.$route.meta.mode!==this.$store.state.app.userMode&&this.$router.push({path:this.redirectUrl})},handleModeChange:function(t){}}}},"79eb":function(t,e,i){"use strict";i.r(e);var c=function(){var t=this,e=t.$createElement,c=t._self._c||e;return c("div",{staticClass:"my-full-form-wrapper",style:{"font-size":t.fontSize},attrs:{id:"formRoot"}},[c("fixed-form-header",{scopedSlots:t._u([{key:"header",fn:function(){return[c("form-header",{attrs:{title:"School Curriculum","show-share":!1,"show-collaborate":!1,"is-preview-mode":!0},on:{back:t.goBack},scopedSlots:t._u([{key:"back",fn:function(){return[c("img",{staticClass:"single-logo-img",attrs:{src:i("be50"),alt:"classcipe"},on:{click:function(e){return e.stopPropagation(),t.$router.push("/")}}})]},proxy:!0},{key:"left",fn:function(){return[c("a-space",{attrs:{size:5,align:"center"},on:{click:function(t){t.stopPropagation()}}},[c("label",{staticStyle:{cursor:"pointer"},on:{click:function(e){return t.$router.push("/account/info")}}},[t._v("Account Info")]),c("label",{attrs:{for:""}},[t._v(">")]),c("label",{staticStyle:{"font-weight":"normal"}},[t._v(t._s(t.userMode===t.USER_MODE.SELF?"":"School ")+"Curriculum")])])]},proxy:!0},{key:"right",fn:function(){},proxy:!0}])})]},proxy:!0}])}),c("div",{staticClass:"form-content"},[c("div",{staticClass:"status-tab"},[c("div",{staticClass:"tab-list"},t._l(t.filterTabs,(function(e,i){return c("div",{key:"types"+i,class:{"tab-item":!0,active:t.currentTab===e.value},on:{click:function(i){return t.toggleTab(e.value)}}},[t._v(" "+t._s(e.title)+" ")])})),0)]),c("div",{staticClass:"form-tab"},[c("curiculum-sel",{directives:[{name:"show",rawName:"v-show",value:"Curriculum"===t.currentTab,expression:"currentTab === 'Curriculum'"}],ref:"CurriculumRef",attrs:{school:t.currentSchool},on:{change:t.changeCurriculum,"save-success":function(e){return t.successCb("pendingCurriculum",e)}}}),c("div",{directives:[{name:"show",rawName:"v-show",value:"Subject"===t.currentTab,expression:"currentTab === 'Subject'"}],staticStyle:{"font-size":"14px",height:"calc(100% - 50px)"}},[c("subject-sel",{ref:"SubjectRef",attrs:{curriculum:t.currentCurriculum,school:t.currentSchool,ibAuth:t.currentAuth},on:{change:t.changeSubjects,"save-success":function(e){return t.successCb("pendingSubject",e)}}})],1),c("div",{directives:[{name:"show",rawName:"v-show",value:"Authorization"===t.currentTab,expression:"currentTab === 'Authorization'"}],staticStyle:{"font-size":"14px",height:"calc(100% - 0px)"}},[c("authorize-sel",{ref:"AuthorizationRef",attrs:{curriculum:t.currentCurriculum,school:t.currentSchool},on:{change:t.changeAuth,"save-success":function(e){return t.successCb("pendingAuthorization",e)}}})],1)],1)]),c("div",{directives:[{name:"show",rawName:"v-show",value:"Authorization"!==t.currentTab,expression:"currentTab !== 'Authorization'"}],staticStyle:{"font-size":"16px"}},[c("fixed-form-footer",{scopedSlots:t._u([{key:"right",fn:function(){return[c("a-button",{staticClass:"cc-round-button",attrs:{loading:t.saveLoading,type:"primary"},on:{click:t.handleNextStep}},[[t._v(" "+t._s(t.SaveTxt)+" ")]],2)]},proxy:!0}])})],1)],1)},s=[],r=i("2909"),a=i("5530"),n=(i("4de4"),i("7db0"),i("f93e")),u=i("6e84"),o=i("21fb"),l=i("ac42"),d=i("b5ff8"),h=i("920f"),f=i("b5a9"),m=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"curiculum-con"},[i("div",{staticClass:"curiculum-list"},[i("a-spin",{attrs:{spinning:t.loading}},[i("div",{staticClass:"curiculum-detail"},t._l(t.curriculumOptions,(function(e){return i("div",{key:"circulum+"+e.id,staticClass:"detail-item"},[i("div",{staticClass:"item-check"},[e.disabled?i("a-tooltip",{attrs:{title:"This curriculum has linked with class, you can unselect this curriculum after you archive all the relevant classes"}},[i("a-checkbox",{attrs:{disabled:!0},model:{value:e.checked,callback:function(i){t.$set(e,"checked",i)},expression:"circulum.checked"}},[t._v(" "+t._s(e.name)+" ")])],1):i("a-checkbox",{on:{change:function(i){return t.onChange(i,e)}},model:{value:e.checked,callback:function(i){t.$set(e,"checked",i)},expression:"circulum.checked"}},[t._v(" "+t._s(e.name)+" ")])],1)])})),0)])],1),i("div",{staticClass:"curiculum-content"},[i("year-name-set",{ref:"yearNameSet",attrs:{curriculums:t.choosed,school:t.currentSchool},on:{disabledCurriculum:t.handleSetDisabled,save:t.handleSave}})],1),i("class-archive-batch",{ref:"classArchiveBatch",attrs:{school:t.currentSchool},on:{finish:t.truelySave}})],1)},p=[],g=i("3835"),b=(i("d3b7"),i("3ca3"),i("ddb0"),i("d81d"),i("159b"),i("99af"),i("b0c0"),i("c740"),i("a434"),i("caad"),i("2532"),i("d597")),v=i("8ee6"),C=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"year-name-set"},[i("a-spin",{attrs:{spinning:t.loading}},[t.currentCurriculums&&t.currentCurriculums.length>0?[i("a-form-model",t._b({ref:"form",attrs:{layout:"horizontal",model:t.gradeForm}},"a-form-model",t.formItemLayout,!1),t._l(t.currentCurriculums,(function(e){return i("div",{key:"curriculum"+e.id,staticClass:"year-name-curriculum"},[i("a-row",{staticClass:"curriculum-title"},[i("a-col",{attrs:{span:t.formItemLayout.labelCol.span}},[i("a-checkbox",{attrs:{indeterminate:e.indeterminate,checked:e.checkAll},on:{change:function(i){return t.changeCurriculum(i,e)}}},[t._v(t._s(e.name||e.curriculumName))])],1),i("a-col",{attrs:{span:18}},[i("a-row",{attrs:{gutter:16}},[i("a-col",{staticStyle:{"text-align":"left",color:"#333","line-height":"24px"},attrs:{span:12}},[t._v(" Enter your school's Grade/Level/Year ")]),i("a-col",{staticStyle:{"text-align":"left",color:"#333","line-height":"24px"},attrs:{span:12}},[t._v(" Enter student age ")])],1)],1)],1),t._l(t.gradeForm.gradeInfo.filter((function(t){return t.curriculumId===e.id})),(function(e,c){return[i("a-form-model-item",{key:"grade"+c,staticClass:"mb0"},[i("div",{staticClass:"grade-item",attrs:{slot:"label"},slot:"label"},[t.gradeHasClass(e)?[i("a-tooltip",{attrs:{title:"This grade has linked with class, you can unselect this grade after you archive all the relevant classes"}},[i("a-checkbox",{attrs:{disabled:e.disabled},on:{change:function(i){return t.changeGradeCheck(i,e)}},model:{value:e.checked,callback:function(i){t.$set(e,"checked",i)},expression:"grade.checked"}},[t._v(t._s(e.officialGradeName))])],1)]:i("a-checkbox",{attrs:{disabled:e.disabled},on:{change:function(i){return t.changeGradeCheck(i,e)}},model:{value:e.checked,callback:function(i){t.$set(e,"checked",i)},expression:"grade.checked"}},[t._v(t._s(e.officialGradeName))])],2),i("a-row",{attrs:{gutter:16}},[i("a-col",{attrs:{span:12}},[i("a-form-model-item",[i("a-input",{attrs:{disabled:!e.checked,placeholder:"input name"},model:{value:e.gradeName,callback:function(i){t.$set(e,"gradeName",i)},expression:"grade.gradeName"}})],1)],1),i("a-col",{attrs:{span:12}},[i("a-form-model-item",[i("a-input-number",{attrs:{disabled:!e.checked,placeholder:"input age"},model:{value:e.age,callback:function(i){t.$set(e,"age",i)},expression:"grade.age"}})],1)],1)],1)],1)]}))],2)})),0)]:t._e(),t.currentCurriculums&&0!==t.currentCurriculums.length||t.loading?t._e():i("div",{staticClass:"empty-tips"},[i("no-more-resources")],1)],2)],1)},S=[],y=i("1da1"),j=(i("96cf"),i("ac1f"),i("1276"),i("ad59")),k=i("69b3"),I=i("4fcf"),_=I.debounce,O=I.cloneDeep,x=I.groupBy,w={name:"YearNameSet",components:{NoMoreResources:k["a"]},props:{school:{type:Object,default:function(){}},curriculums:{type:Array,default:function(){return[]}}},watch:{school:{handler:function(t){this.currentSchool=Object(a["a"])({},t),t.id&&this.debounceInit()},deep:!0},curriculums:{handler:function(t){this.initCurriculum(t)},immediate:!1,deep:!0}},created:function(){this.debounceInit=_(this.initData,500),this.currentSchool.id&&this.initData()},data:function(){return{currentSchool:this.school,currentCurriculumId:this.curriculumId,loading:!1,activeTab:"year",grades:[],currentCurriculums:[],allCurriculums:[],formItemLayout:{labelCol:{span:6},wrapperCol:{span:18}},forms:{},gradeInfoTotal:[],gradeForm:{gradeInfo:[{gradeId:"",gradeName:"",gradeNameArr:"",age:null,officialGradeName:"",curriculumId:"",checked:!1}]},origin:{},gradeInfoTree:{},totalClass:[]}},methods:{initDict:function(){var t=this;return Object(y["a"])(regeneratorRuntime.mark((function e(){var i,c,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([Object(j["g"])({schoolId:t.currentSchool.id,pageNo:1,pageSize:1e4})]);case 2:i=e.sent,c=Object(g["a"])(i,1),s=c[0],s.success&&s.result&&(t.totalClass=s.result.records);case 6:case"end":return e.stop()}}),e)})))()},initData:function(){var t=this;return Object(y["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loading=!0,e.next=3,t.initDict();case 3:Promise.all([Object(b["f"])(),Object(b["e"])()]).then((function(e){var i=Object(g["a"])(e,2),c=i[0],s=i[1];c.success&&(t.grades=c.result),s.success&&(t.allCurriculums=s.result),t.gradeInfoTotal=t.grades.map((function(t){var e={gradeId:t.id,gradeName:t.name,gradeNameArr:t.name.split(","),officialGradeName:t.name,curriculumId:t.curriculumId,age:t.age,checked:!0,disabled:!1};return e})),t.initCurriculum(t.curriculums)})).finally((function(e){t.loading=!1}));case 4:case"end":return e.stop()}}),e)})))()},initCurriculum:function(t){var e=this,i=[],c=[];t.forEach((function(t){var s=e.gradeInfoTotal.filter((function(e){return e.curriculumId===t.curriculumId})),r=e.gradeForm.gradeInfo.filter((function(e){return e.curriculumId===t.curriculumId}));if(t.gradeSettingInfo){var n=s.map((function(i){var s=t.gradeSettingInfo.find((function(t){return t.gradeId===i.gradeId})),n=r.find((function(t){return t.gradeId===i.gradeId})),u=!1,o=e.totalClass.find((function(t){return t.gradeId===i.gradeId}));return o&&(u=!0,c.push(t.curriculumId)),n?Object(a["a"])({},n):s?Object(a["a"])(Object(a["a"])({},s),{},{gradeNameArr:s.gradeName.split(","),curriculumId:t.curriculumId,checked:!0,disabled:u}):Object(a["a"])(Object(a["a"])({},i),{},{checked:!1,disabled:u})}));i=i.concat(n)}else{var u=s.map((function(i){var s=r.find((function(t){return t.gradeId===i.gradeId})),n=!1,u=e.totalClass.find((function(t){return t.gradeId===i.gradeId}));return u&&(n=!0,c.push(t.curriculumId)),s?Object(a["a"])(Object(a["a"])({},s),{},{disabled:n}):Object(a["a"])(Object(a["a"])({},i),{},{disabled:n})}));i=i.concat(O(u))}})),this.$emit("disabledCurriculum",c),this.gradeForm.gradeInfo=i;var s=x(i,"curriculumId");this.origin=O(this.gradeForm);var r=t.map((function(t){var e=!1,i=!1;if(s[t.id]){var c=s[t.id].filter((function(t){return t.checked}));c.length===s[t.id].length?i=!0:c.length>0&&(e=!0)}return t.checkAll=i,t.indeterminate=e,t}));this.currentCurriculums=O(r)},changeCurriculum:function(t,e){e.checkAll=t.target.checked,e.indeterminate=!1,this.gradeForm.gradeInfo.forEach((function(i){i.curriculumId!==e.id||i.disabled||(i.checked=t.target.checked)}))},changeGradeCheck:function(t,e){e.checked=t.target.checked;var i=this.currentCurriculums.find((function(t){return t.id===e.curriculumId})),c=x(this.gradeForm.gradeInfo,"curriculumId"),s=!1,r=!1;if(c[e.curriculumId]){var a=c[e.curriculumId].filter((function(t){return t.checked}));a.length===c[e.curriculumId].length?r=!0:a.length>0&&(s=!0)}i.checkAll=r,i.indeterminate=s},handleCancel:function(){this.$emit("cancel")},handleSave:function(){var t=this;this.$refs.form.validate((function(e){if(e){var i=t.gradeForm.gradeInfo.filter((function(t){return t.checked})),c=x(i,"curriculumId"),s=[],r=function(e){var i=t.allCurriculums.find((function(t){return t.id===e}));if(i){var r=c[e].map((function(t){return Object(a["a"])({},t)}));s.push({curriculumId:i.id,curriculumName:i.name,gradeSettingInfo:r})}};for(var n in c)r(n);t.$emit("save",s)}}))},gradeHasClass:function(t){var e=this.totalClass.find((function(e){return e.gradeId===t.gradeId}));return!!e}}},R=w,A=(i("8768"),i("0c7c")),$=Object(A["a"])(R,C,S,!1,null,"6173139c",null),E=$.exports,T=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("a-modal",{attrs:{destroyOnClose:"",title:"Class change confirm",footer:null,width:"500px",confirmLoading:t.loading},on:{cancel:t.handleCancel},model:{value:t.selVis,callback:function(e){t.selVis=e},expression:"selVis"}},[i("div",[i("label",{attrs:{for:""}},[t._v(" All the classes under this curriculum will be cleared if you disable it, would you like to archive all the classes before you make the changes? ")]),i("a-divider",{staticStyle:{width:"auto",margin:"24px -24px"}}),i("a-space",[i("a-button",{on:{click:t.handleCancel}},[t._v("Cancel")]),i("a-button",{attrs:{loading:t.loading,type:"primary"},on:{click:t.handleArchive}},[t._v("Archive all classes")])],1)],1)])},L=[],D=(i("a15b"),i("9bfe")),N={name:"ClassArchiveBatch",props:{school:{type:Object,default:function(){}}},watch:{school:{handler:function(t){this.currentSchool=Object(a["a"])({},t),this.initData()},deep:!0,immediate:!0}},data:function(){return{currentSchool:this.school,allClass:[],schoolSubjects:[],model:{curriculumIds:[],gradeIds:[],subjectIds:[],curriculums:[]},loading:!1,selVis:!1}},methods:{initData:function(){var t=this;this.loading=!0,Promise.all([Object(j["g"])({pageNo:1,pageSize:1e4,schoolId:this.currentSchool.id}),Object(D["a"])({schoolId:this.currentSchool.id})]).then((function(e){var i=Object(g["a"])(e,2),c=i[0],s=i[1];c.success&&c.result&&(t.allClass=c.result.records),s.success&&(t.schoolSubjects=s.result)})).finally((function(){t.loading=!1}))},doCreate:function(t){this.loading=!1,this.model=Object(a["a"])({},t);var e=this.getEffectClasses();e.length>0?this.selVis=!0:this.$emit("finish",this.model.curriculums)},handleCancel:function(){this.$emit("finish",null),this.selVis=!1},getEffectClasses:function(){var t=this,e=this.model.subjectIds||[],i=this.model.gradeIds||[],c=[];if(this.model.curriculumIds&&this.model.curriculumIds.length>0){var s=this.schoolSubjects.filter((function(e){return t.model.curriculumIds.includes(e.curriculumId)})).map((function(t){return t.subjectList})),a=s.reduce((function(t,e){return t.concat(Object(r["a"])(e))}),[]).map((function(t){return t.subjectId}));e=e.concat(a)}return this.allClass&&this.allClass.length>0&&(c=this.allClass.filter((function(t){return i.includes(t.gradeId)||e.includes(t.subject)}))),c},handleArchive:function(){var t=this,e=this.getEffectClasses();e.length>0?(this.loading=!0,Object(j["d"])({ids:e.map((function(t){return t.id})).join(",")}).then((function(e){e.success&&0===e.code&&(t.$message.success("Archive successfully"),t.$emit("finish",t.model.curriculums),t.selVis=!1)})).finally((function(){t.loading=!1}))):(this.$emit("finish",this.model.curriculums),this.selVis=!1)},handleDelete:function(){var t=this,e=this.getEffectClasses();e.length>0?(this.loading=!0,Object(j["f"])({ids:e.map((function(t){return t.id})).join(",")}).then((function(e){e.success&&0===e.code&&(t.$message.success("Delete successfully"),t.$emit("finish",t.model.curriculums),t.selVis=!1)})).finally((function(){t.loading=!1}))):(this.$emit("finish",this.model.curriculums),this.selVis=!1)}}},B=N,z=Object(A["a"])(B,T,L,!1,null,"0a4277f2",null),P=z.exports,F=i("cd3f"),U=i.n(F),M=i("1775"),V=i("a305"),Y={name:"CirculumSel",components:{YearNameSet:E,ClassArchiveBatch:P},props:{school:{type:Object,default:function(){}}},watch:{school:{handler:function(t){this.currentSchool=Object(a["a"])({},t),this.initData()},deep:!0,immediate:!0}},data:function(){return{currentSchool:this.school,curriculumOptions:[],allOptions:[],queryParam:{searchKey:""},choosed:[],origin:[],yearSetVisible:!1,initCurriculum:[],loading:!1}},created:function(){},methods:{initData:function(){var t=this;this.loading=!0,Promise.all([Object(b["e"])(),Object(v["a"])({schoolId:this.currentSchool.id})]).then((function(e){var i=Object(g["a"])(e,2),c=i[0],s=i[1];if(c.success&&s.success){var n=[];t.initCurriculum=s.result,t.allOptions=c.result.map((function(e){var i=!1;return e.curriculumId=e.id,s.result&&s.result.length>0?s.result.forEach((function(t){t.curriculumId===e.id&&(i=!0,t.id=e.id,t.curriculumId=e.id,e.gradeSettingInfo=t.gradeSettingInfo?Object(r["a"])(t.gradeSettingInfo):[],n.push(U()(t)))})):t.currentSchool.curriculumId,Object(a["a"])(Object(a["a"])({},e),{},{checked:i})})),t.choosed=U()(n),t.origin=n,t.$emit("change",t.choosed),t.curriculumOptions=t.allOptions.map((function(t){return Object(a["a"])(Object(a["a"])({},t),{},{disabled:!1})}))}})).finally((function(){t.loading=!1}))},reset:function(){this.initData()},triggerSearch:function(){var t=this;this.queryParam.searchKey||(this.curriculumOptions=this.allOptions.concat()),this.curriculumOptions=this.allOptions.filter((function(e){return e.name.toLowerCase().indexOf(t.queryParam.searchKey.toLowerCase())>-1}))},onChange:function(t,e){if(!t.target.checked&&1===this.choosed.length)return this.$message.error("Please select at least one"),void(e.checked=!0);if(this.curriculumOptions.forEach((function(i){i.id===e.id&&(i.checked=t.target.checked)})),t.target.checked)this.choosed.push(Object(a["a"])({},e));else{var i=this.choosed.findIndex((function(t){return t.id===e.id}));i>-1&&this.choosed.splice(i,1)}var c=Object(M["a"])(this.origin,this.choosed,"curriculumId"),s=Object(M["a"])(this.choosed,this.origin,"curriculumId");this.$emit("change",this.choosed,c.length>0||s.length>0)},doSave:function(){this.$refs.yearNameSet.handleSave()},handleSave:function(t){var e=this.diffChanges(this.origin,t);e.curriculumIds.length>0||e.gradeIds.length>0?this.$refs.classArchiveBatch.doCreate(Object(a["a"])(Object(a["a"])({},e),{},{curriculums:t})):this.truelySave(t)},truelySave:function(t){var e=this;t?(this.loading=!0,Object(v["b"])({schoolId:this.currentSchool.id,curriculums:t}).then((function(t){t.success&&e.initData()})).finally((function(){e.$emit("save-success"),e.loading=!1,e.$store.dispatch("initSubjectGradeData",{schoolId:e.$store.getters.school,bindCurriculumId:e.$store.getters.bindCurriculum,applyType:e.$store.state.app.userMode===n["Y"].SCHOOL?1:2,applyUserId:e.$store.state.user.info.id})}))):this.$emit("save-success",!0)},diffChanges:function(t,e){var i=Object(M["a"])(t,e,"curriculumId"),c=i.map((function(t){return t.curriculumId})),s=Object(V["a"])(t,(function(t,e){return t.concat(e.gradeSettingInfo)}),[]),r=Object(V["a"])(e,(function(t,e){return t.concat(e.gradeSettingInfo)}),[]),a=Object(M["a"])(s,r,"gradeId"),n=a.map((function(t){return t.gradeId}));return{curriculumIds:c,gradeIds:n}},handleSetDisabled:function(t){t.length>0&&this.curriculumOptions.forEach((function(e){t.includes(e.id)?e.disabled=!0:e.disabled=!1}))}}},q=Y,G=(i("1c62"),Object(A["a"])(q,m,p,!1,null,"60f2a224",null)),H=G.exports,W=function(){var t=this,e=t.$createElement,c=t._self._c||e;return c("div",{staticClass:"subject-col"},[t.currentCurriculum?c("div",[c("div",{ref:"subjectWrap",staticClass:"subject-result-wrap"},[c("div",{staticClass:"subject-circulum"},t._l(t.currentCurriculum,(function(e){return c("div",{key:e.id,class:{"circulum-item":!0,active:e.id===t.choosed.id},on:{click:function(i){return t.chooseCurriculum(e)}}},[c("div",{staticClass:"circulum-item-avatar"},[c("a-avatar",{style:{backgroundColor:"#3377FF",verticalAlign:"middle"},attrs:{shape:"square",size:50}},[t._v(" "+t._s((e.curriculumName||e.name).substring(0,2))+" ")])],1),c("div",{staticClass:"circulum-item-detail"},[c("div",[t._v(t._s(e.curriculumName||e.name))])])])})),0),c("div",{ref:"subjectSelected",staticClass:"subject-selected"},[c("div",{staticClass:"selected-title"},[t._v("Selected"),c("b",{ref:"curName",staticStyle:{display:"none"}},[t._v(" : "+t._s(t.choosed.curriculumName||t.choosed.name))])]),t.totalResult[t.choosed.id]?c("div",{directives:[{name:"show",rawName:"v-show",value:!t.noChecked,expression:"!noChecked"}],staticClass:"subject-selected-wrap"},t._l(t.totalResult[t.choosed.id].result,(function(e,i){return c("div",{key:"seletedArea_"+i,staticClass:"selected-content"},[c("div",{directives:[{name:"show",rawName:"v-show",value:e.checkedList.length>0,expression:"item.checkedList.length > 0"}],staticClass:"selected-content-title"},[t._v(" "+t._s(e.name)+" ")]),c("a-space",{directives:[{name:"show",rawName:"v-show",value:e.checkedList.length>0,expression:"item.checkedList.length > 0"}],staticClass:"selected-content-detail"},t._l(e.checkedList,(function(s,r){return c("a-tag",{key:"tagCat"+i+"tag"+r,staticClass:"tag-item",attrs:{closable:!0},on:{close:function(e){return t.closeTag(e,i,r,t.choosed.id)}}},[t._v(" "+t._s(t.formatTag(e,s,t.choosed.id))+" ")])})),1)],1)})),0):t._e(),c("div",{directives:[{name:"show",rawName:"v-show",value:t.noChecked,expression:"noChecked"}]},[t._v("You have not selected any subject")])]),c("div",{ref:"copySelected"})]),t.totalResult[t.choosed.id]?c("div",{staticClass:"subject-area"},t._l(t.totalResult[t.choosed.id].result,(function(e,i){return c("div",{key:"subectArr_"+i,staticClass:"subject-area-item"},[c("div",{staticClass:"area-item-title"},[t._v(" Subjects in "+t._s(e.name)+" "),c("a-checkbox",{attrs:{disabled:e.disabled,indeterminate:e.indeterminate,checked:e.checkAll},on:{change:function(e){return t.onCheckAllChange(e,i,t.choosed.id)}}},[t._v("Select all ")])],1),c("div",{staticClass:"area-item-check"},[c("a-checkbox-group",{attrs:{options:e.data},on:{change:function(e){return t.onCheckChange(e,i,t.choosed.id)}},scopedSlots:t._u([{key:"label",fn:function(e){var i=e.label;return c("span",{},[t._v(t._s(i))])}}],null,!0),model:{value:e.checkedList,callback:function(i){t.$set(e,"checkedList",i)},expression:"item.checkedList"}})],1)])})),0):t._e()]):t._e(),c("div",{directives:[{name:"show",rawName:"v-show",value:!t.currentCurriculum,expression:"!currentCurriculum"}],staticClass:"no-subject"},[c("img",{attrs:{src:i("11f0")}}),c("p",[t._v("None Subject because you dont choose the Circulum")])]),c("class-archive-batch",{ref:"classArchiveBatch",attrs:{school:t.currentSchool},on:{finish:t.truelySave}})],1)},K=[],Q=(i("a630"),i("6062"),i("c418")),J=i("5b2e"),X={name:"SubjectSel",components:{ClassArchiveBatch:P},props:{curriculum:{type:Array,default:function(){return[]}},school:{type:Object,default:function(){}},ibAuth:{type:Object,default:function(){}}},watch:{curriculum:{handler:function(t,e){this.currentCurriculum=t?Object(r["a"])(t):[],this.initData()},immediate:!0,deep:!0},school:{handler:function(t,e){this.currentSchool=t?Object(a["a"])({},t):null,this.initSubject()},immediate:!0},ibAuth:{handler:function(t,e){this.curriclulumAuth=t?Object(a["a"])({},t):{},this.setSelected()},immediate:!0,deep:!0}},data:function(){return{loading:!1,currentSchool:this.school,choosed:null,totalResult:{"-1":{curriculumId:"",selected:[],currentSelected:[],result:[{indeterminate:!1,checkAll:!1,checkedList:[]}]}},initResult:[],curriclulumAuth:{}}},computed:{noChecked:function(){var t=this.totalResult[this.choosed.id],e=t?t.result:[];return 0===e.length||!e.find((function(t){return t.checkedList.length>0}))}},mounted:function(){window.addEventListener("scroll",this.fixSelected,!0)},destroyed:function(){window.removeEventListener("scroll",this.fixSelected)},methods:{initData:function(){var t=this;if(this.choosed){var e=this.currentCurriculum.find((function(e){return e.id===t.choosed.id}));e||(this.choosed=Object(a["a"])({},this.currentCurriculum[0]))}else this.choosed=Object(a["a"])({},this.currentCurriculum[0]);this.choosed.id&&!this.totalResult[this.choosed.id]?(this.loading=!0,Object(Q["SubjectTree"])({curriculumId:this.choosed.id}).then((function(e){if(e.success){var i=e.result.map((function(t){return Object(a["a"])(Object(a["a"])({},t),{},{indeterminate:!1,checkAll:!1,checkedList:[],disabled:!1,data:t.children.map((function(t){return{label:t.name,value:t.id,disabled:!1}}))})}));t.$set(t.totalResult,t.choosed.id,{selected:[],currentSelected:[],result:i}),t.setSelected()}}))):this.setSelected()},initSubject:function(){var t=this;this.currentSchool&&this.currentSchool.id&&Object(D["a"])({schoolId:this.currentSchool.id}).then((function(e){e.success&&e.result&&(t.initResult=e.result,t.setSelected())}))},chooseCurriculum:function(t){this.choosed=Object(a["a"])({},t),this.initData()},reset:function(){this.setSelected()},setSelected:function(){var t=this;if(this.initResult&&this.initResult.length>0){var e=function(e){if(!t.curriclulumAuth[e]||2===t.curriclulumAuth[e].status){var i=t.initResult.find((function(t){return t.curriculumId===e}));if(i&&i.subjectList.length>0)t.totalResult[e].currentSelected=i.subjectList.map((function(t){return t.subjectId}));else{var c=t.totalResult[e],s=[];c.result.forEach((function(t){t.children&&t.children.length>0&&(s=s.concat(t.children.map((function(t){return t.id}))))})),c.currentSelected=s}}};for(var i in this.totalResult)e(i)}else for(var c in this.totalResult)this.curriclulumAuth[c]&&2!==this.curriclulumAuth[c].status||function(){var e=t.totalResult[c],i=[];e.result.forEach((function(t){t.children&&t.children.length>0&&(i=i.concat(t.children.map((function(t){return t.id}))))})),e.currentSelected=i}();var s=function(e){if("-1"===e)return"continue";var i=t.curriclulumAuth[e]&&2!==t.curriclulumAuth[e].status,c=t.totalResult[e];c.selected=[],c.result=c.result.map((function(t){var e=[],s=!1,n=!1;return t.children&&t.children.length>0&&(e=t.children.filter((function(t){return c.currentSelected.includes(t.id)})).map((function(t){return t.id})),e=Array.from(new Set([].concat(Object(r["a"])(t.checkedList),Object(r["a"])(e)))),c.selected=e.concat(),e.length===t.children.length?n=!0:e.length>0&&(s=!0)),Object(a["a"])(Object(a["a"])({},t),{},{data:t.data.map((function(t){return Object(a["a"])(Object(a["a"])({},t),{},{disabled:i})})),indeterminate:s,checkAll:n,checkedList:e,disabled:i})}))};for(var n in this.totalResult)s(n);this.sendChecked()},formatTag:function(t,e){if(t.children&&e){var i=t.children.find((function(t){return t.id===e}));return i?i.name:null}return null},fixSelected:function(){if(this.$refs.subjectWrap&&this.$refs.subjectSelected){var t=this.$refs.subjectWrap.getBoundingClientRect(),e=this.$refs.subjectSelected.getBoundingClientRect();t.top<-104?(this.$refs.subjectSelected.style.cssText="position:fixed;top:60px;background: #fff;width:".concat(t.width,"px;margin-left: -24px;padding: 20px;border: 1px solid #dfdfdf;box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.16);"),this.$refs.copySelected.style.cssText="display: block;height: ".concat(e.height,"px;"),this.$refs.curName.style.display="block"):(this.$refs.subjectSelected.style.cssText="",this.$refs.copySelected.style.cssText="",this.$refs.curName.style.display="none")}},sendChecked:function(){var t=[];for(var e in this.totalResult){var i=this.totalResult[e].result;i.forEach((function(e){t=t.concat(e.checkedList)}))}this.$emit("change",t)},onCheckAllChange:function(t,e,i){Object.assign(this.totalResult[i].result[e],{checkedList:t.target.checked?this.totalResult[i].result[e].data.concat().map((function(t){return t.value})):[],indeterminate:!1,checkAll:t.target.checked}),this.sendChecked()},onCheckChange:function(t,e,i){this.totalResult[i].result[e].indeterminate=!!t.length&&t.length<this.totalResult[i].result[e].data.length,this.totalResult[i].result[e].checkAll=t.length===this.totalResult[i].result[e].data.length,this.sendChecked()},closeTag:function(t,e,i,c){this.totalResult[c].result[e].checkedList.splice(i,1),this.onCheckChange(this.totalResult[c].result[e].checkedList,e,c)},doSave:function(){var t=[];for(var e in this.totalResult)if("-1"!==e){var i=this.totalResult[e].result,c=this.totalResult[e].currentSelected,s=Object(V["a"])(i,(function(t,e){return t.concat(e.checkedList)}),[]);t=t.concat(Object(J["a"])(c,s))}t.length>0?this.$refs.classArchiveBatch.doCreate({subjectIds:t,curriculums:!0}):this.truelySave(!0)},truelySave:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e){var c=[],s=function(e){if("-1"!==e){var i=t.totalResult[e].result,s=[];i.forEach((function(t){t.checkedList.length>0&&t.children.forEach((function(i){t.checkedList.includes(i.id)&&s.push({curriculumId:e,parentSubjectId:t.id,parentSubjectName:t.name,subjectId:i.id,subjectName:i.name})}))})),c.push({curriculumId:e,schoolId:t.currentSchool.id,subjectList:s})}};for(var r in this.totalResult)s(r);Promise.all(c.map((function(t){return Object(D["b"])(t)}))).then((function(t){})).finally((function(){t.initSubject(),t.$emit("save-success",i),t.$store.dispatch("initSubjectGradeData",{schoolId:t.$store.getters.school,bindCurriculumId:t.$store.getters.bindCurriculum,applyType:t.$store.state.app.userMode===n["Y"].SCHOOL?1:2,applyUserId:t.$store.state.user.info.id})}))}else this.$emit("save-success",!0)}}},Z=X,tt=(i("b3a6"),Object(A["a"])(Z,W,K,!1,null,"1063b7b4",null)),et=tt.exports,it=function(){var t=this,e=t.$createElement,c=t._self._c||e;return c("div",{staticClass:"authorize-col"},[t.currentCurriculum?c("div",[c("div",{staticClass:"authorize-result-wrap"},[c("div",{staticClass:"subject-circulum"},t._l(t.currentCurriculum,(function(e){return c("div",{key:e.id,class:{"circulum-item":!0,active:e.id===t.choosed.id},on:{click:function(i){return t.chooseCurriculum(e)}}},[c("div",{staticClass:"circulum-item-avatar"},[c("a-avatar",{style:{backgroundColor:"#3377FF",verticalAlign:"middle"},attrs:{shape:"square",size:50}},[t._v(" "+t._s((e.curriculumName||e.name).substring(0,2))+" ")])],1),c("div",{staticClass:"circulum-item-detail"},[c("div",[t._v(t._s(e.curriculumName||e.name))])])])})),0)]),t.totalResult[t.choosed.id]?c("div",{staticClass:"authrize-form"},[c("a-form-model",t._b({ref:"form",attrs:{model:t.totalResult[t.choosed.id],rules:t.validatorRules}},"a-form-model",t.formItemLayout,!1),[c("a-form-model-item",{attrs:{required:!0}},[c("span",{attrs:{slot:"label"},slot:"label"},[t._v(" Resources  "),c("a-tooltip",{attrs:{title:"Please make sure upload all necessary resource for teaching plan including subject guides, ATL and etc."}},[c("a-icon",{attrs:{type:"question-circle-o"}})],1)],1),""===t.totalResult[t.choosed.id].status||3===t.totalResult[t.choosed.id].status?c("a-upload",{attrs:{showUploadList:!1,accept:"image/png, image/jpeg,  application/pdf",customRequest:function(e){return t.handleUploadImage(e,"resources")}}},[c("a-button",{attrs:{loading:t.uploading}},[c("a-icon",{attrs:{type:"upload"}}),t._v(" Click to Upload image/PDF ")],1)],1):t._e(),t.totalResult[t.choosed.id].resources?c("div",{staticClass:"file-list",attrs:{slot:"extra"},slot:"extra"},t._l(t.totalResult[t.choosed.id].resources.split(","),(function(e){return c("div",{key:e,staticClass:"file-item"},[e?[c("div",{staticClass:"preview-file"},[c("div",{staticClass:"img"},[t.isPdf(e)?c("div",[c("a-icon",{attrs:{type:"file-pdf"}})],1):c("img",{attrs:{src:e,alt:""}})]),c("a",{attrs:{href:e,target:"_blank",for:""}},[t._v(t._s(t.urlName(e)))]),""===t.totalResult[t.choosed.id].status||3===t.totalResult[t.choosed.id].status?c("a-icon",{staticClass:"close",attrs:{type:"close"},on:{click:function(i){return t.handleRemove("resources",e)}}}):t._e()],1)]:t._e()],2)})),0):t._e()],1),c("a-form-model-item",{attrs:{required:!0}},[c("span",{attrs:{slot:"label"},slot:"label"},[t._v(" Certificate  "),c("a-tooltip",{attrs:{title:"Please upload relevant certificates to prove that you are entitled to use the resources above"}},[c("a-icon",{attrs:{type:"question-circle-o"}})],1)],1),""===t.totalResult[t.choosed.id].status||3===t.totalResult[t.choosed.id].status?c("a-upload",{attrs:{showUploadList:!1,accept:"image/png, image/jpeg,  application/pdf",customRequest:function(e){return t.handleUploadImage(e,"certificate")}}},[c("a-button",{attrs:{loading:t.uploading}},[c("a-icon",{attrs:{type:"upload"}}),t._v(" Click to Upload image/PDF ")],1)],1):t._e(),t.totalResult[t.choosed.id].certificate?c("div",{staticClass:"file-list",attrs:{slot:"extra"},slot:"extra"},t._l(t.totalResult[t.choosed.id].certificate.split(","),(function(e){return c("div",{key:e,staticClass:"file-item"},[e?[c("div",{staticClass:"preview-file"},[c("div",{staticClass:"img"},[t.isPdf(e)?c("div",[c("a-icon",{attrs:{type:"file-pdf"}})],1):c("img",{attrs:{src:e,alt:""}})]),c("a",{attrs:{href:e,target:"_blank",for:""}},[t._v(t._s(t.urlName(e)))]),""===t.totalResult[t.choosed.id].status||3===t.totalResult[t.choosed.id].status?c("a-icon",{staticClass:"close",attrs:{type:"close"},on:{click:function(i){return t.handleRemove("certificate",e)}}}):t._e()],1)]:t._e()],2)})),0):t._e()],1),c("a-form-model-item",{attrs:{wrapperCol:{offset:4,span:12},prop:"isAgree",label:""}},[c("a-checkbox",{staticStyle:{"line-height":"20px"},attrs:{disabled:1===t.totalResult[t.choosed.id].status||2===t.totalResult[t.choosed.id].status},model:{value:t.totalResult[t.choosed.id].isAgree,callback:function(e){t.$set(t.totalResult[t.choosed.id],"isAgree",e)},expression:"totalResult[choosed.id].isAgree"}},[t._v(" School/I has been certified by IB to use its teaching resources for academic purposes, therefore School/I authorize Classcipe to upload necessary data to assist my teaching. ")])],1),c("a-form-model-item",{attrs:{wrapperCol:{offset:4,span:12},label:""}},[1===t.totalResult[t.choosed.id].status?c("div",{staticClass:"status-text"},[c("span",[t._v("Authorization status: In progress")])]):t._e(),2===t.totalResult[t.choosed.id].status?c("div",{staticClass:"status-text"},[c("a-icon",{attrs:{type:"check-circle"}}),t._v(" "),c("span",[t._v("Approved")])],1):t._e(),3===t.totalResult[t.choosed.id].status?[c("div",{staticClass:"status-text deny"},[c("a-icon",{attrs:{type:"close-circle"}}),t._v(" "),c("span",[t._v("Application denied")])],1),c("div",{staticClass:"deny-text"},[t._v("Reason for refusal: "+t._s(t.totalResult[t.choosed.id].denyReason)+" ")])]:t._e()],2),t.canEdit?c("a-form-model-item",{attrs:{wrapperCol:{offset:4,span:12},label:""}},[c("a-button",{staticStyle:{"line-height":"1"},attrs:{disabled:!t.totalResult[t.choosed.id].isAgree,loading:t.loading,type:"primary"},on:{click:t.doSave}},[t._v(t._s(3===t.totalResult[t.choosed.id].status?"Submit again":"Submit"))])],1):t._e()],1)],1):t._e()]):t._e(),c("div",{directives:[{name:"show",rawName:"v-show",value:!t.currentCurriculum,expression:"!currentCurriculum"}],staticClass:"no-subject"},[c("img",{attrs:{src:i("11f0")}}),c("p",[t._v("None Authorization because you dont choose the Circulum")])])])},ct=[],st=i("8207"),rt=i("d344"),at=i("d0d0"),nt=i("2f62"),ut=[n["b"].IBPYP,n["b"].IBMYP],ot={name:"AuthorizeSel",components:{CustomerUploadFile:rt["a"]},props:{curriculum:{type:Array,default:function(){return[]}},school:{type:Object,default:function(){}}},watch:{curriculum:{handler:function(t,e){var i=t?Object(r["a"])(t):[];this.currentCurriculum=i.filter((function(t){return ut.includes(t.id)})),this.initData()},immediate:!0,deep:!0},school:{handler:function(t,e){this.currentSchool=t?Object(a["a"])({},t):null,this.initAuths()},immediate:!0}},data:function(){return{loading:!1,formItemLayout:{labelCol:{span:4},wrapperCol:{span:12}},currentCurriculum:[],currentSchool:this.school,choosed:null,totalResult:{},authForm:{applyType:1,certificate:"",curriculumId:"",resources:"",schoolId:"",isAgree:!1},listAuths:[],validatorRules:{certificate:[{required:!0,message:"Please upload certificate!",trigger:"change"}],resources:[{required:!0,message:"Please upload resources!",trigger:"change"}],isAgree:[{required:!0,message:"Please agree first!",trigger:"change"}]},uploading:!1}},computed:Object(a["a"])(Object(a["a"])({},Object(nt["e"])({info:function(t){return t.user.info},userMode:function(t){return t.app.userMode}})),{},{canEdit:function(){return!(1===this.totalResult[this.choosed.id].status||2===this.totalResult[this.choosed.id].status)}}),methods:{initData:function(){var t=this;if(this.choosed){var e=this.currentCurriculum.find((function(e){return e.id===t.choosed.id}));e||(this.choosed=Object(a["a"])({},this.currentCurriculum[0]))}else this.choosed=Object(a["a"])({},this.currentCurriculum[0]);this.totalResult||(this.totalResult={}),this.choosed.id&&!this.totalResult[this.choosed.id]&&this.$set(this.totalResult,this.choosed.id,{applyType:1,certificate:"",id:"",status:"",curriculumId:this.choosed.id,resources:"",isAgree:!1,schoolId:this.currentSchool.id}),this.setSelected()},initAuths:function(){var t=this;this.currentSchool&&this.currentSchool.id&&Object(st["a"])({schoolId:this.currentSchool.id,pageNo:1,pageSize:1e3,queryType:1}).then((function(e){e.success&&(t.listAuths=e.result.records.filter((function(e){return e.schoolId===t.currentSchool.id})),t.setSelected())}))},chooseCurriculum:function(t){this.choosed=Object(a["a"])({},t),this.initData()},setSelected:function(){var t=this,e=this.userMode===n["Y"].SELF?2:1;if(this.listAuths&&this.listAuths.length>0){var i=function(i){var c=t.listAuths.find((function(c){var s=!0;return t.userMode===n["Y"].SELF&&(s=c.applyUserId===t.info.id&&c.applyType===e),c.curriculumId===i&&s&&c.schoolId===t.currentSchool.id}));c&&t.$set(t.totalResult,i,Object(a["a"])(Object(a["a"])({},c),{},{isAgree:!0}))};for(var c in this.totalResult)i(c)}this.totalResult&&this.$emit("change",this.totalResult)},uploadFile:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=this.totalResult[this.choosed.id][t].split(",").filter((function(t){return!!t}));i?c.push(e.url):c=[e.url],this.totalResult[this.choosed.id][t]=c.join(",")},handleRemove:function(t,e){var i=this.totalResult[this.choosed.id][t].split(",").filter((function(t){return!!t})),c=i.findIndex((function(t){return t===e}));i.splice(c,1),this.totalResult[this.choosed.id][t]=i.join(",")},urlName:function(t){var e=t.split("_").pop();return decodeURIComponent(e)},isPdf:function(t){var e=t.split(".").pop();return"pdf"===e},doSave:function(){var t=this,e=Object(a["a"])({},this.totalResult[this.choosed.id]);e.schoolId=this.currentSchool.id,e.resources?e.certificate?(this.userMode===n["Y"].SELF?e.applyType=2:e.applyType=1,this.loading=!0,Object(st["b"])(e).then((function(e){e.success&&(t.$message.success("Application received, we will process it as soon as possible"),t.initAuths())})).finally((function(){t.loading=!1}))):this.$message.error("Please upload certificate"):this.$message.error("Please upload resources")},handleUploadImage:function(t,e){var i=this,c=t.file.type.indexOf("image")>-1?"image":t.file.type.indexOf("video")>-1?"video":t.file.type;this.uploading=!0,this.uploader=Object(at["a"])(this.$store.getters.userInfo.id,t.file,(function(t){}),(function(t){i.uploading=!1,i.uploadFile(e,{type:c,url:t},!0)}),!0)}}},lt=ot,dt=(i("5113"),Object(A["a"])(lt,it,ct,!1,null,"5bb1ed25",null)),ht=dt.exports,ft={name:"CuriculumListV2",components:{FixedFormHeader:d["a"],FixedFormFooter:h["a"],FormHeader:f["a"],CuriculumSel:H,SubjectSel:et,AuthorizeSel:ht},mixins:[u["a"],o["a"],l["a"]],data:function(){return{fontSize:"16px",fixHtmlWidth:1e3,USER_MODE:n["Y"],currentTab:"Curriculum",tabsList:[{value:"Curriculum",title:"Curriculum"},{value:"Subject",title:"Subject"},{value:"Authorization",title:"IB authorization"}],curriculumChanged:!1,pendingCurriculum:!1,pendingSubject:!1,pendingAuthorization:!1,saveLoading:!1,currentCurriculum:[],currentAuth:{}}},computed:Object(a["a"])(Object(a["a"])({},Object(nt["e"])({info:function(t){return t.user.info},bindCurriculum:function(t){return t.user.bindCurriculum},currentSchool:function(t){return t.user.currentSchool},userMode:function(t){return t.app.userMode}})),{},{filterTabs:function(){var t=this;return this.tabsList.filter((function(e){var i=t.currentCurriculum.find((function(t){return t.id===n["b"].IBPYP||t.id===n["b"].IBMYP}));return!!i||"Authorization"!==e.value}))},SaveTxt:function(){if("Curriculum"===this.currentTab)return"Next";var t=this.currentCurriculum.find((function(t){return t.id===n["b"].IBPYP||t.id===n["b"].IBMYP}));return t?"Next":"Finish"}}),created:function(){},methods:{goBack:function(){this.$router.go(-1)},toggleTab:function(t){var e=this;"Subject"===t&&this.curriculumChanged?this.$confirm({content:"Your curiculum has changed. Do you want to save first? ",centered:!0,onOk:function(){e.saveLoading=!0,e.$refs.CurriculumRef.doSave()}}):this.currentTab=t},changeCurriculum:function(t,e){this.curriculumChanged=e,this.currentCurriculum=Object(r["a"])(t)},changeSubjects:function(t){this.changedSubjects=Object(r["a"])(t)},changeAuth:function(t){this.currentAuth=Object(a["a"])({},t)},successCb:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!i&&this.$message.success("Save successfully"),this.saveLoading=!1,!i){var c=this.currentCurriculum.find((function(t){return t.id===n["b"].IBPYP||t.id===n["b"].IBMYP})),s=this.currentCurriculum.find((function(t){return(t.id===n["b"].IBPYP||t.id===n["b"].IBMYP)&&(!e.currentAuth[t.id]||!e.currentAuth[t.id].status)}));"pendingCurriculum"===t?this.currentTab=c&&s?"Authorization":"Subject":"pendingSubject"===t&&(c?this.currentTab="Authorization":this.$router.push("/account/info"),this.$store.dispatch("GetClassList",this.$store.state.user.currentSchool.id))}},handleNextStep:function(){"Curriculum"===this.currentTab?(this.saveLoading=!0,this.$refs.CurriculumRef.doSave(),this.$refs.SubjectRef.truelySave(!0,!0)):"Subject"===this.currentTab?(this.saveLoading=!0,this.$refs.SubjectRef.doSave()):"Authorization"===this.currentTab&&(this.saveLoading=!0,this.$refs.AuthorizationRef.doSave())}}},mt=ft,pt=(i("9201"),Object(A["a"])(mt,c,s,!1,null,"11e60ca9",null));e["default"]=pt.exports},"7cd9":function(t,e,i){},8332:function(t,e,i){},8768:function(t,e,i){"use strict";i("7cd9")},9201:function(t,e,i){"use strict";i("8332")},"920f":function(t,e,i){"use strict";var c=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"cc-fixed-form-footer",style:{left:t.collapsed?t.$classcipe.sysConfig.collapsedSidebarWidth+"px":t.$classcipe.sysConfig.sidebarWidth+"px"}},[t.showMask?i("div",{staticClass:"step-mask"}):t._e(),i("div",{staticClass:"left"},[t._t("left")],2),i("div",{staticClass:"right"},[t._t("right")],2)])},s=[],r=i("5530"),a=i("2f62"),n={name:"FixedFormFooter",props:{showMask:{type:Boolean,default:!1}},data:function(){return{}},computed:Object(r["a"])({},Object(a["e"])({collapsed:function(t){return t.app.sideCollapsed}})),created:function(){},methods:{}},u=n,o=(i("9a02"),i("0c7c")),l=Object(o["a"])(u,c,s,!1,null,"26a750b3",null);e["a"]=l.exports},"9a02":function(t,e,i){"use strict";i("a5b7")},a5b7:function(t,e,i){},ac42:function(t,e,i){"use strict";i.d(e,"a",(function(){return c}));var c={data:function(){return{fontSize:"16px",fixHtmlWidth:0,radioSwitchShow:!1}},mounted:function(){window.addEventListener("resize",this.resizeFn,!1),this.resizeFn()},beforeDestroy:function(){window.removeEventListener("resize",this.resizeFn)},methods:{resizeFn:function(){this.radioSwitchShow=!1;var t=document.documentElement,e=t.getBoundingClientRect().width;this.fixHtmlWidth>0&&(e=this.fixHtmlWidth);var i=e/16;this.fontSize=i+"px",this.radioSwitchShow=!0}}}},adbe:function(t,e,i){},b3a6:function(t,e,i){"use strict";i("4826")},c2fe:function(t,e,i){},c418:function(t,e,i){"use strict";i.r(e),i.d(e,"subjectAPIUrl",(function(){return s})),i.d(e,"SubjectTree",(function(){return r})),i.d(e,"SubjectAddOrUpdate",(function(){return a})),i.d(e,"SubjectQueryById",(function(){return n})),i.d(e,"SubjectDelete",(function(){return u})),i.d(e,"SubjectDeleteBatch",(function(){return o})),i.d(e,"SubjectList",(function(){return l})),i.d(e,"SubjectStudentList",(function(){return d}));var c=i("b775"),s={SubjectTree:"/classcipe/api/subject/tree",SubjectAddOrUpdate:"/classcipe/api/subject/addOrUpdate",SubjectQueryById:"/classcipe/api/subject/queryById",SubjectDelete:"/classcipe/api/subject/delete",SubjectDeleteBatch:"/classcipe/api/subject/deleteBatch",SubjectList:"/classcipe/api/subject/list",SubjectStudentList:"/classcipe/api/subject/getStudentSubjects"};function r(t){return Object(c["d"])({url:s.SubjectTree,method:"get",params:t})}function a(t){return Object(c["d"])({url:s.SubjectAddOrUpdate,method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function n(t){return Object(c["d"])({url:s.SubjectQueryById,method:"get",params:t})}function u(t){return Object(c["d"])({url:s.SubjectDelete,method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function o(t){return Object(c["d"])({url:s.SubjectDeleteBatch,method:"post",data:t,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function l(t){return Object(c["d"])({url:s.SubjectList,method:"get",params:t})}function d(t){return Object(c["d"])({url:s.SubjectStudentList,method:"get",params:t})}},d344:function(t,e,i){"use strict";var c=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"custom-cover-media",style:{width:t.width,height:t.height}},[i("a-upload-dragger",{staticClass:"cc-upload",attrs:{showUploadList:!1,accept:t.accept,customRequest:t.handleUploadImage,name:"file"}},[t._t("fileList",(function(){return[t.mediaUrl||t.url?["image"===(t.mediaType||t.type)?i("div",{staticClass:"uploaded-cover"},[i("div",{staticClass:"img-cover",style:{backgroundImage:"url('"+(t.mediaUrl||t.url)+"')"}})]):"video"===(t.mediaType||t.type)?i("div",{staticClass:"upload-text"},[i("video",{attrs:{src:t.mediaUrl||t.url,controls:t.videoControls}})]):i("div",[i("a-icon",{attrs:{type:t.uploading?"loading":"file"}}),i("div",{staticClass:"ant-upload-text"},[t._v(" Upload "+t._s(t.type)+" ")])],1)]:i("div",[i("a-icon",{attrs:{type:t.uploading?"loading":"plus"}}),i("div",{staticClass:"ant-upload-text"},[t._v(" Upload "+t._s(t.type)+" ")])],1)]})),t.uploading?t._e():i("div",{staticClass:"upload-tips"},[i("custom-media-cover-button",{directives:[{name:"show",rawName:"v-show",value:t.showUploadButton,expression:"showUploadButton"}],attrs:{label:t.label,"bg-color":"#2582B5","font-color":"#fff"}}),i("custom-media-cover-button",{directives:[{name:"show",rawName:"v-show",value:t.showEditButton,expression:"showEditButton"}],attrs:{label:"Edit","bg-color":"#2582B5","font-color":"#fff"},nativeOn:{"!click":function(e){return e.stopPropagation(),t.handleEdit(e)}}}),i("custom-media-cover-button",{directives:[{name:"show",rawName:"v-show",value:t.showDeleteButton,expression:"showDeleteButton"}],attrs:{label:"Delete","bg-color":"#2582B5","font-color":"#fff"},nativeOn:{"!click":function(e){return e.stopPropagation(),t.handleDelete(e)}}})],1)],2),i("div",{directives:[{name:"show",rawName:"v-show",value:t.uploading,expression:"uploading"}],staticClass:"uploading-progress"},[i("div",{staticClass:"progress"},[i("a-progress",{attrs:{percent:t.progressPercent,strokeColor:"#2582B5"}}),i("custom-link-text",{staticClass:"cancel-text",attrs:{text:"Cancel",color:"#fff"},on:{click:t.handleCancel}})],1)])],1)},s=[],r=i("823b"),a=i("d0d0"),n=i("0381"),u=i("658c"),o=i("4357"),l={COVER_MEDIA_EDIT:"COVER_MEDIA_EDIT",COVER_MEDIA_UPDATE:"COVER_MEDIA_UPDATE",COVER_MEDIA_ADD:"COVER_MEDIA_ADD",COVER_MEDIA_DELETE:"COVER_MEDIA_DELETE"},d={name:"CustomCoverMedia",components:{CustomLinkText:o["a"],CustomMediaCoverButton:u["a"],CustomButton:n["a"]},props:{accept:{type:String,default:"image/png, image/jpeg"},type:{type:String,default:"image"},url:{type:String,default:null},videoControls:{type:Boolean,default:!0},width:{type:String,default:"320px"},height:{type:String,default:"180px"},labelText:{type:String,default:null},showUploadButton:{type:Boolean,default:!0},showEditButton:{type:Boolean,default:!1},showDeleteButton:{type:Boolean,default:!1},videoItem:{type:[Object,String],default:null},emitGlobalEvent:{type:Boolean,default:!0}},data:function(){return{uploading:!1,mediaType:null,mediaUrl:null,progressPercent:0,uploader:null}},computed:{label:function(){return this.labelText?this.labelText:"image"===this.type?"Upload Image":"Upload"}},methods:{handleUploadImage:function(t){var e=this;r["info"]("handleUploadImage data",t),this.mediaType=t.file.type.indexOf("image")>-1?"image":t.file.type.indexOf("video")>-1?"video":t.file.type,this.progressPercent=0,this.uploading=!0,this.uploader=Object(a["a"])(this.$store.getters.userInfo.id,t.file,(function(t){e.$logger.info("progressSize",t),e.progressPercent=t}),(function(t){e.$logger.info("handleUploadImage result",t),e.mediaUrl=t,e.uploading=!1,e.$emit("update",{type:e.mediaType,url:e.mediaUrl})}),!0)},handleCancel:function(){this.uploader&&(this.uploader.abort(),this.uploading=!1,this.progressPercent=0)},handleEdit:function(){this.$logger.info("handleEdit",this.videoItem)},handleDelete:function(){this.$logger.info("handleDelete",this.videoItem),this.$emit("delete",this.videoItem),this.emitGlobalEvent&&this.$EventBus.$emit(l.COVER_MEDIA_DELETE,this.videoItem)}}},h=d,f=(i("e4b3"),i("0c7c")),m=Object(f["a"])(h,c,s,!1,null,"69250f59",null);e["a"]=m.exports},e4b3:function(t,e,i){"use strict";i("12a0")}}]);