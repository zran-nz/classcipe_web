(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-03402fac"],{"279f":function(module,__webpack_exports__,__webpack_require__){"use strict";eval('// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js?{"cacheDirectory":"node_modules/.cache/vue-loader","cacheIdentifier":"227a4198-vue-loader-template"}!./node_modules/@vue/cli-service/node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/cache-loader/dist/cjs.js??ref--0-0!./node_modules/@vue/cli-service/node_modules/vue-loader/lib??vue-loader-options!./src/views/student/StudentEvaluation.vue?vue&type=template&id=64e62c4c&scoped=true&\nvar render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c(\'div\',{staticClass:"my-full-form-wrapper"},[_c(\'div\',{staticClass:"form-header"},[_c(\'common-form-header\',{ref:"commonFormHeader",attrs:{"form":_vm.form,"show-back":false,"showCollaborate":false,"last-change-saved-time":_vm.lastChangeSavedTime},on:{"update-form":_vm.handleUpdateForm,"back":_vm.goBack,"save":_vm.handleSaveAndBackEvaluation,"publish":_vm.handlePublishEvaluation}})],1),_c(\'a-card\',{attrs:{"bordered":false,"bodyStyle":{ padding: \'16px 24px\', height: \'100%\', minHeight: \'500px\' },"loading":_vm.loading}},[_c(\'div\',{directives:[{name:"show",rawName:"v-show",value:(!_vm.showWaitingMask),expression:"!showWaitingMask"}],staticClass:"class-session-evaluation"},[_c(\'div\',{staticClass:"header"},[_c(\'div\',{staticClass:"left-action"},[_c(\'div\',{staticClass:"add-btn"})])]),_c(\'div\',{directives:[{name:"show",rawName:"v-show",value:(_vm.forms.length > 0),expression:"forms.length > 0"}],staticClass:"form-table-tabs"},_vm._l((_vm.forms),function(formItem,idx){return _c(\'div\',{key:idx,class:{\'form-table-item\': true,\n                   \'active-table\': _vm.currentActiveFormId === formItem.formId},attrs:{"data-form-id":formItem.formId,"data-form-type":formItem.formType},on:{"click":function($event){return _vm.handleActiveForm(idx, formItem)}}},[_c(\'div\',{directives:[{name:"show",rawName:"v-show",value:(formItem.titleEditing === false),expression:"formItem.titleEditing === false"}],staticClass:"action-icon"},[_c(\'div\',{staticClass:"form-title-item"},[_c(\'div\',{staticClass:"form-title",on:{"dblclick":function($event){return _vm.handleEditFormTitle(formItem)}}},[_vm._v(_vm._s(formItem.title))]),_c(\'div\',{directives:[{name:"show",rawName:"v-show",value:(_vm.mode === _vm.EvaluationTableMode.Edit),expression:"mode === EvaluationTableMode.Edit"}],staticClass:"form-delete-icon"},[_c(\'a-popconfirm\',{attrs:{"title":"Delete this form ?","ok-text":"Yes","cancel-text":"No"},on:{"confirm":function($event){return _vm.handleDeleteForm(formItem)}}},[_c(\'a-icon\',{attrs:{"type":"delete"}})],1)],1)])]),_c(\'div\',{directives:[{name:"show",rawName:"v-show",value:(formItem.titleEditing === true),expression:"formItem.titleEditing === true"}],staticClass:"editing-title"},[_c(\'a-input\',{staticClass:"my-title-input",on:{"blur":_vm.handleEnsureUpdateFormTitle,"keyup":function($event){if(!$event.type.indexOf(\'key\')&&_vm._k($event.keyCode,"enter",13,$event.key,"Enter")){ return null; }return _vm.handleEnsureUpdateFormTitle.apply(null, arguments)}},model:{value:(_vm.currentEditingTitle),callback:function ($$v) {_vm.currentEditingTitle=$$v},expression:"currentEditingTitle"}})],1)])}),0),_c(\'div\',{staticClass:"body"},[_c(\'div\',{staticClass:"class-group"},[_c(\'div\',{staticClass:"class-student-wrapper"},[_c(\'div\',{staticClass:"group-list-wrapper"},[_c(\'div\',{staticClass:"no-group-student-list"},[_c(\'div\',{staticClass:"student-list"},_vm._l((_vm.allNoGroupStudentUserList),function(member,sIndex){return _c(\'div\',{directives:[{name:"show",rawName:"v-show",value:(_vm.attendanceEmailList.indexOf(member.email) !== -1),expression:"attendanceEmailList.indexOf(member.email) !== -1"}],key:sIndex,class:{\'list-item\': true, \'selected-student\': _vm.currentActiveStudentId === member.userId, \'heartbeat\': ((_vm.studentEvaluateIdList.length || _vm.peerEvaluateIdList.length) && _vm.studentEvaluateIdList.indexOf(member.userId) === -1 && _vm.peerEvaluateIdList.indexOf(member.userId) === -1)},style:({ \'filter\': _vm.selectedMemberIdList.indexOf(member.userId) === -1 ? \'grayscale(100%)\': \'none\'}),attrs:{"data-member-id":member.userId},on:{"click":function($event){return _vm.handleClickMember(null, member)}}},[_c(\'div\',{staticClass:"student-avatar"},[(member.studentAvatar)?_c(\'img\',{attrs:{"src":member.studentAvatar,"alt":""}}):_vm._e(),(!member.studentAvatar)?_c(\'img\',{attrs:{"slot":"prefix","src":__webpack_require__("a6bd"),"alt":""},slot:"prefix"}):_vm._e()]),_c(\'div\',{staticClass:"student-name",attrs:{"data-email":member.userId}},[_c(\'a-tooltip\',{attrs:{"placement":"top","mouseEnterDelay":1}},[_c(\'template\',{slot:"title"},[_vm._v(" "+_vm._s(member.email)+" ")]),_vm._v(" "+_vm._s(member.realName)+" ")],2)],1),(_vm.selectedMemberIdList.indexOf(member.userId) !== -1)?_c(\'div\',{staticClass:"select-status-icon"},[_c(\'a-icon\',{staticClass:"my-selected-icon",staticStyle:{"{color":"#07AB84}"},attrs:{"type":"check-circle","theme":"filled"}})],1):_vm._e()])}),0)]),_vm._l((_vm.groups),function(group,gIdx){return _c(\'div\',{key:gIdx,class:{\'group-item\': true, \'selected-group\': _vm.selectedGroupIdList.indexOf(group.id) !== -1},attrs:{"data-group-id":group.id}},[_c(\'div\',{staticClass:"group-item-info",on:{"click":function($event){return _vm.handleSelectGroup(group)}}},[_c(\'div\',{staticClass:"group-left"},[_c(\'div\',{staticClass:"group-icon"},[_c(\'group-icon\')],1),_c(\'div\',{staticClass:"group-name"},[_vm._v(" "+_vm._s(group.name)+" ("+_vm._s(group.attendanceList.length)+") ")]),_c(\'div\',{staticClass:"group-select-status"},[(_vm.selectedGroupIdList.indexOf(group.id) !== -1)?[_c(\'a-icon\',{staticClass:"my-selected-icon",staticStyle:{"{color":"#07AB84}"},attrs:{"type":"check-circle","theme":"filled"}})]:_vm._e()],2)]),_c(\'div\',{staticClass:"group-right",on:{"click":function($event){return _vm.handleToggleGroupExpand(group, $event)}}},[_c(\'div\',{staticClass:"group-expand-status"},[(group.expand)?[_c(\'arrow-down\')]:_vm._e(),(!group.expand)?[_c(\'arrow-top\')]:_vm._e()],2)])]),_c(\'div\',{directives:[{name:"show",rawName:"v-show",value:(group.expand),expression:"group.expand"}],staticClass:"group-student-list"},[_c(\'div\',{staticClass:"student-list"},_vm._l((group.members),function(member,sIndex){return _c(\'div\',{directives:[{name:"show",rawName:"v-show",value:(_vm.attendanceEmailList.indexOf(member.email) !== -1),expression:"attendanceEmailList.indexOf(member.email) !== -1"}],key:sIndex,class:{\'list-item\': true, \'selected-student\': _vm.currentActiveStudentId === member.userId, \'heartbeat\': ((_vm.studentEvaluateIdList.length || _vm.peerEvaluateIdList.length) && _vm.studentEvaluateIdList.indexOf(member.userId) === -1 && _vm.peerEvaluateIdList.indexOf(member.userId) === -1)},style:({ \'filter\': _vm.selectedMemberIdList.indexOf(member.userId) === -1 ? \'grayscale(100%)\': \'none\'}),attrs:{"data-member-id":member.userId},on:{"click":function($event){return _vm.handleClickMember(group, member)}}},[_c(\'div\',{staticClass:"student-avatar"},[(member.studentAvatar)?_c(\'img\',{attrs:{"src":member.studentAvatar,"alt":""}}):_vm._e(),(!member.studentAvatar)?_c(\'img\',{attrs:{"slot":"prefix","src":__webpack_require__("a6bd"),"alt":""},slot:"prefix"}):_vm._e()]),_c(\'div\',{staticClass:"student-name",attrs:{"data-email":member.email}},[_c(\'a-tooltip\',{attrs:{"placement":"top","mouseEnterDelay":1}},[_c(\'template\',{slot:"title"},[_vm._v(" "+_vm._s(member.email)+" ")]),_vm._v(" "+_vm._s(member.realName)+" ")],2)],1),(_vm.selectedMemberIdList.indexOf(member.userId) !== -1)?_c(\'div\',{staticClass:"select-status-icon"},[_c(\'a-icon\',{staticClass:"my-selected-icon",staticStyle:{"{color":"#07AB84}"},attrs:{"type":"check-circle","theme":"filled"}})],1):_vm._e()])}),0)])])}),_c(\'div\',{staticClass:"no-group-tips"},[(_vm.allStudentUserList.length === 0 && !_vm.loading)?_c(\'a-empty\',{attrs:{"description":"No student exist"}}):_vm._e()],1)],2)])]),_c(\'div\',{staticClass:"form-table-content",attrs:{"data-mode":_vm.mode}},[(_vm.currentActiveStudentId && !_vm.loading)?_c(\'div\',{staticClass:"table-content"},_vm._l((_vm.forms),function(formItem,tIdx){return _c(\'div\',{key:tIdx,staticClass:"form-table-item"},[_c(\'div\',{directives:[{name:"show",rawName:"v-show",value:(formItem.formId === _vm.currentActiveFormId),expression:"formItem.formId === currentActiveFormId"}],staticClass:"form-table-item-content"},[_c(\'div\',{staticClass:"form-header-line"},[_c(\'div\',{staticClass:"right-icon"},[_c(\'div\',{staticClass:"icon-type-item"},[_c(\'div\',{staticClass:"icon-item"},[_c(\'teacher-icon\')],1),_c(\'div\',{staticClass:"label"},[_vm._v("Teacher")])]),_c(\'div\',{staticClass:"icon-type-item"},[_c(\'div\',{staticClass:"icon-item"},[_c(\'student-icon\')],1),_c(\'div\',{staticClass:"label"},[_vm._v("My Self")])]),_c(\'div\',{staticClass:"icon-type-item"},[_c(\'div\',{staticClass:"icon-item"},[_c(\'peer-icon\')],1),_c(\'div\',{staticClass:"label"},[_vm._v("Peer")])])]),_c(\'div\',{staticClass:"form-action"},[(_vm.mode === _vm.EvaluationTableMode.StudentEvaluate && _vm.hasNewEvaluationDataReceived)?_c(\'a-button\',{staticClass:"my-form-header-btn",staticStyle:{"{\\n                          width":"120px","display":"flex","flex-direction":"row","align-items":"center","justify-content":"center","background":"rgba(21, 195, 154, 0.08)","border":"1px solid #15C39A","border-radius":"20px","padding":"15px 20px"},attrs:{"icon":"reload"},on:{"click":_vm.handleRefreshEvaluationData}},[_vm._v(" Refresh to see ")]):_vm._e(),_c(\'a-button\',{staticClass:"my-form-header-btn",staticStyle:{"{\\n                          width":"120px","display":"flex","flex-direction":"row","align-items":"center","justify-content":"center","background":"rgba(21, 195, 154, 0.08)","border":"1px solid #15C39A","border-radius":"20px","padding":"15px 20px"},on:{"click":_vm.handleSaveEvaluation}},[_c(\'div\',{staticClass:"btn-icon"},[_c(\'img\',{attrs:{"src":__webpack_require__("f7b2")}})]),_c(\'div\',{staticClass:"btn-text"},[_vm._v(" Submit ")])])],1)]),_c(\'div\',{staticClass:"comment"},[(_vm.currentActiveFormId && _vm.currentActiveStudentId)?_c(\'div\',{staticClass:"summary-input"},[_c(\'a-textarea\',{staticClass:"my-textarea",attrs:{"disabled":_vm.mode !== _vm.EvaluationTableMode.TeacherEvaluate,"placeholder":"Write a comment","aria-placeholder":"Write a comment"},on:{"keyup":function($event){return _vm.handleUpdateComment(_vm.studentEvaluateData[_vm.currentActiveStudentId][_vm.currentActiveFormId].comment)}},model:{value:(_vm.studentEvaluateData[_vm.currentActiveStudentId][_vm.currentActiveFormId].comment),callback:function ($$v) {_vm.$set(_vm.studentEvaluateData[_vm.currentActiveStudentId][_vm.currentActiveFormId], "comment", $$v)},expression:"studentEvaluateData[currentActiveStudentId][currentActiveFormId].comment"}})],1):_vm._e()]),_c(\'div\',{staticClass:"student-question"},[(_vm.currentActiveFormId && _vm.currentActiveStudentId && _vm.studentEvaluateData[_vm.currentActiveStudentId][_vm.currentActiveFormId].hasOwnProperty(\'question1\'))?_c(\'div\',{staticClass:"summary-input student-question-item"},[_c(\'div\',{staticClass:"question-text"},[_vm._v("What\'s the most important thing you learned today? Why do you think so?")]),_c(\'a-textarea\',{staticClass:"my-textarea",attrs:{"placeholder":"What’s the most important thing you learned today? Why do you think so?"},model:{value:(_vm.studentEvaluateData[_vm.currentActiveStudentId][_vm.currentActiveFormId].question1),callback:function ($$v) {_vm.$set(_vm.studentEvaluateData[_vm.currentActiveStudentId][_vm.currentActiveFormId], "question1", $$v)},expression:"studentEvaluateData[currentActiveStudentId][currentActiveFormId].question1"}})],1):_vm._e(),(_vm.currentActiveFormId && _vm.currentActiveStudentId && _vm.studentEvaluateData[_vm.currentActiveStudentId][_vm.currentActiveFormId].hasOwnProperty(\'question2\'))?_c(\'div\',{staticClass:"summary-input student-question-item"},[_c(\'div\',{staticClass:"question-text"},[_vm._v("What do you want to learn more about, and why?")]),_c(\'a-textarea\',{staticClass:"my-textarea",attrs:{"placeholder":"What do you want to learn more about, and why?"},model:{value:(_vm.studentEvaluateData[_vm.currentActiveStudentId][_vm.currentActiveFormId].question2),callback:function ($$v) {_vm.$set(_vm.studentEvaluateData[_vm.currentActiveStudentId][_vm.currentActiveFormId], "question2", $$v)},expression:"studentEvaluateData[currentActiveStudentId][currentActiveFormId].question2"}})],1):_vm._e(),(_vm.currentActiveFormId && _vm.currentActiveStudentId && _vm.studentEvaluateData[_vm.currentActiveStudentId][_vm.currentActiveFormId].hasOwnProperty(\'question3\'))?_c(\'div\',{staticClass:"summary-input student-question-item"},[_c(\'div\',{staticClass:"question-text"},[_vm._v("What made you curious today? How does learning feel different when you’re curious?")]),_c(\'a-textarea\',{staticClass:"my-textarea",attrs:{"placeholder":"What’s the most important thing you learned today? Why do you think so?"},model:{value:(_vm.studentEvaluateData[_vm.currentActiveStudentId][_vm.currentActiveFormId].question3),callback:function ($$v) {_vm.$set(_vm.studentEvaluateData[_vm.currentActiveStudentId][_vm.currentActiveFormId], "question3", $$v)},expression:"studentEvaluateData[currentActiveStudentId][currentActiveFormId].question3"}})],1):_vm._e()]),_c(\'div\',{staticClass:"form-table-detail"},[_c(\'evaluation-table\',{ref:"evaluationTable",refInFor:true,attrs:{"form-id":formItem.formId,"init-raw-headers":formItem.initRawHeaders,"init-raw-data":formItem.initRawData,"form-type":formItem.formType,"mode":_vm.mode,"form-body-data":_vm.formBodyData},on:{"update-evaluation":_vm.handleUpdateEvaluate,"add-evidence":_vm.handleAddEvidence,"error-mode":_vm.handleErrorMode}})],1)])])}),0):_vm._e(),(_vm.forms.length === 0 && !_vm.loading)?[_c(\'div\',{staticClass:"no-form-tips"},[_c(\'no-more-resources\',{attrs:{"tips":"The evaluation form has not been created!"}})],1)]:_vm._e()],2)])]),_c(\'div\',{directives:[{name:"show",rawName:"v-show",value:(_vm.showWaitingMask),expression:"showWaitingMask"}],staticClass:"waiting-mask"},[_c(\'no-more-resources\',{attrs:{"tips":"Teacher is editing, please wait..."}})],1)]),_c(\'a-drawer\',{attrs:{"destroyOnClose":"","placement":"right","width":"1020px","visible":_vm.evidenceSelectVisible},on:{"close":function($event){_vm.evidenceSelectVisible = false}}},[_c(\'div\',{staticClass:"add-evaluation-evidence-wrapper"},[(_vm.currentEvidenceItem)?_c(\'div\',{staticClass:"slide-preview"},[_c(\'ppt-slide-view\',{attrs:{"selected-id-list":_vm.currentEvidenceItem.evidence.selectedList,"selected-id-student-list":_vm.currentEvidenceItem.evidence.selectedStudentList,"row-id":_vm.currentEvidenceItem.rowId,"form-id":_vm.currentActiveFormId,"session-id":_vm.sessionId,"slide-id":_vm.classInfo.slideId,"student-name":_vm.selectedMemberIdList.length ? _vm.selectedMemberIdList[0] : null,"mode":_vm.mode},on:{"ensure-evidence-finish":_vm.handleEnsureEvidenceFinish,"cancel-evidence-finish":_vm.handleCancelEvidenceFinish}}),(!_vm.classInfo || !_vm.classInfo.slideId)?[_c(\'no-more-resources\',{attrs:{"tips":"no slide"}})]:_vm._e()],2):_vm._e()])])],1)}\nvar staticRenderFns = []\n\n\n// CONCATENATED MODULE: ./src/views/student/StudentEvaluation.vue?vue&type=template&id=64e62c4c&scoped=true&\n\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.object.to-string.js\nvar es_object_to_string = __webpack_require__("d3b7");\n\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.set.js\nvar es_set = __webpack_require__("6062");\n\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.string.iterator.js\nvar es_string_iterator = __webpack_require__("3ca3");\n\n// EXTERNAL MODULE: ./node_modules/core-js/modules/web.dom-collections.iterator.js\nvar web_dom_collections_iterator = __webpack_require__("ddb0");\n\n// EXTERNAL MODULE: ./node_modules/core-js/modules/web.dom-collections.for-each.js\nvar web_dom_collections_for_each = __webpack_require__("159b");\n\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.map.js\nvar es_array_map = __webpack_require__("d81d");\n\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.includes.js\nvar es_array_includes = __webpack_require__("caad");\n\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.string.includes.js\nvar es_string_includes = __webpack_require__("2532");\n\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.function.name.js\nvar es_function_name = __webpack_require__("b0c0");\n\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.object.keys.js\nvar es_object_keys = __webpack_require__("b64b");\n\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.filter.js\nvar es_array_filter = __webpack_require__("4de4");\n\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.string.starts-with.js\nvar es_string_starts_with = __webpack_require__("2ca0");\n\n// EXTERNAL MODULE: ./src/utils/util.js\nvar util = __webpack_require__("ca00");\n\n// EXTERNAL MODULE: ./src/components/Evaluation/EvaluationTable.vue + 5 modules\nvar EvaluationTable = __webpack_require__("1138");\n\n// EXTERNAL MODULE: ./src/components/Common/CommonFormHeader.vue + 4 modules\nvar CommonFormHeader = __webpack_require__("81c4");\n\n// EXTERNAL MODULE: ./src/assets/svgIcon/evaluation/GrayIcon.svg?inline\nvar GrayIconinline = __webpack_require__("98a4");\nvar GrayIconinline_default = /*#__PURE__*/__webpack_require__.n(GrayIconinline);\n\n// EXTERNAL MODULE: ./src/assets/svgIcon/evaluation/PeerIcon.svg?inline\nvar PeerIconinline = __webpack_require__("5d88");\nvar PeerIconinline_default = /*#__PURE__*/__webpack_require__.n(PeerIconinline);\n\n// EXTERNAL MODULE: ./src/assets/svgIcon/evaluation/StudentIcon.svg?inline\nvar StudentIconinline = __webpack_require__("519d");\nvar StudentIconinline_default = /*#__PURE__*/__webpack_require__.n(StudentIconinline);\n\n// EXTERNAL MODULE: ./src/assets/svgIcon/evaluation/TeacherIcon.svg?inline\nvar TeacherIconinline = __webpack_require__("a615f");\nvar TeacherIconinline_default = /*#__PURE__*/__webpack_require__.n(TeacherIconinline);\n\n// EXTERNAL MODULE: ./src/assets/svgIcon/evaluation/qunzu.svg?inline\nvar qunzuinline = __webpack_require__("4e45");\nvar qunzuinline_default = /*#__PURE__*/__webpack_require__.n(qunzuinline);\n\n// EXTERNAL MODULE: ./src/assets/svgIcon/evaluation/arrow_down.svg?inline\nvar arrow_downinline = __webpack_require__("d8fe");\nvar arrow_downinline_default = /*#__PURE__*/__webpack_require__.n(arrow_downinline);\n\n// EXTERNAL MODULE: ./src/assets/svgIcon/evaluation/arrow_top.svg?inline\nvar arrow_topinline = __webpack_require__("a3c5");\nvar arrow_topinline_default = /*#__PURE__*/__webpack_require__.n(arrow_topinline);\n\n// EXTERNAL MODULE: ./src/components/Common/ModalHeader.vue + 4 modules\nvar ModalHeader = __webpack_require__("60427");\n\n// EXTERNAL MODULE: ./src/api/evaluation.js\nvar evaluation = __webpack_require__("9f06");\n\n// EXTERNAL MODULE: ./src/components/Evaluation/SelectEvaluationList.vue + 4 modules\nvar SelectEvaluationList = __webpack_require__("5f34");\n\n// EXTERNAL MODULE: ./src/components/Evaluation/EvaluationTableType.js\nvar EvaluationTableType = __webpack_require__("7849");\n\n// EXTERNAL MODULE: ./src/components/Evaluation/EvaluationTableMode.js\nvar EvaluationTableMode = __webpack_require__("90e8");\n\n// EXTERNAL MODULE: ./src/components/Common/NoMoreResources.vue + 4 modules\nvar NoMoreResources = __webpack_require__("69b3");\n\n// EXTERNAL MODULE: ./src/components/Evaluation/PptSlideView.vue + 4 modules\nvar PptSlideView = __webpack_require__("7735");\n\n// EXTERNAL MODULE: ./src/const/teacher.js\nvar teacher = __webpack_require__("3f76");\n\n// EXTERNAL MODULE: ./src/components/Evaluation/TeacherEvaluationStatus.js\nvar TeacherEvaluationStatus = __webpack_require__("c948");\n\n// EXTERNAL MODULE: ./src/config/router.config.js + 1 modules\nvar router_config = __webpack_require__("d73b");\n\n// EXTERNAL MODULE: ./src/mixins/EvaluationMixin.js + 1 modules\nvar EvaluationMixin = __webpack_require__("af28");\n\n// EXTERNAL MODULE: ./src/api/schoolClass.js\nvar schoolClass = __webpack_require__("ab9f");\n\n// CONCATENATED MODULE: ./node_modules/cache-loader/dist/cjs.js??ref--12-0!./node_modules/thread-loader/dist/cjs.js!./node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib!./node_modules/cache-loader/dist/cjs.js??ref--0-0!./node_modules/@vue/cli-service/node_modules/vue-loader/lib??vue-loader-options!./src/views/student/StudentEvaluation.vue?vue&type=script&lang=js&\n\n\n\n\n\n\n\n\n\n\n\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/* harmony default export */ var StudentEvaluationvue_type_script_lang_js_ = ({\n  name: \'StudentEvaluation\',\n  components: {\n    PptSlideView: PptSlideView["a" /* default */],\n    NoMoreResources: NoMoreResources["a" /* default */],\n    SelectEvaluationList: SelectEvaluationList["a" /* default */],\n    EvaluationTable: EvaluationTable["a" /* default */],\n    CommonFormHeader: CommonFormHeader["a" /* default */],\n    GrayIcon: GrayIconinline_default.a,\n    PeerIcon: PeerIconinline_default.a,\n    StudentIcon: StudentIconinline_default.a,\n    TeacherIcon: TeacherIconinline_default.a,\n    GroupIcon: qunzuinline_default.a,\n    ArrowDown: arrow_downinline_default.a,\n    ArrowTop: arrow_topinline_default.a,\n    ModalHeader: ModalHeader["a" /* default */]\n  },\n  props: {\n    sessionId: {\n      type: String,\n      required: true\n    }\n  },\n  computed: {\n    lastChangeSavedTime: function lastChangeSavedTime() {\n      var time = this.form && this.form.evaluation && (this.form.evaluation.updateTime || this.form.evaluation.createTime);\n\n      if (time) {\n        return Object(util["formatLocalUTC"])(this.form.evaluation.updateTime || this.form.evaluation.createTime);\n      } else {\n        return \'\';\n      }\n    },\n    formBodyData: function formBodyData() {\n      if (this.currentActiveStudentId && this.currentActiveFormId && this.studentEvaluateData) {\n        return this.studentEvaluateData[this.currentActiveStudentId][this.currentActiveFormId];\n      } else {\n        this.$logger.info(\'no formBodyData currentActiveFormId \' + this.currentActiveFormId + \' currentActiveStudentId \' + this.currentActiveStudentId, \' studentEvaluateData \', this.studentEvaluateData);\n        return null;\n      }\n    },\n    isTeacher: function isTeacher() {\n      return this.$store.getters && this.$store.getters.currentRole === \'teacher\';\n    }\n  },\n  data: function data() {\n    return {\n      taskId: null,\n      mode: EvaluationTableMode["a" /* default */].StudentEvaluate,\n      loading: true,\n      isExistFormTable: false,\n      // 是否已经添加过表格\n      currentActiveFormId: null,\n      form: {\n        // 基础表单数据\n        evaluationMode: \'\',\n        classId: \'\',\n        name: \'\',\n        className: \'\',\n        email: \'\',\n        forms: [],\n        groups: [],\n        updateTime: null,\n        createTime: null,\n        createBy: null,\n        type: teacher["e" /* typeMap */].classSessionEvaluation\n      },\n      // 班级信息\n      classInfo: {\n        classId: null,\n        author: null,\n        // \'yangxunwu@gmail.com\',\n        date: null,\n        // 1636085002,\n        status: null,\n        // \'close\',\n        className: null,\n        // \'测试 课堂\',\n        type: null,\n        // \'slide\',\n        fileName: null,\n        // \'Untitled task\',\n        slideId: null,\n        // \'17kZYJTQTX6rOIhXhisTaE_5ocYILbTJfegW0QUzOnI0\',\n        lockPage: null,\n        // null,\n        responseLimitMode: null,\n        // 1,\n        responseLimitTime: null,\n        // 1638201600,\n        copyFrom: null // null\n\n      },\n      oldFormsJson: null,\n      // 保存旧的评估表格数据\n      oldStudentEvaluationJson: null,\n      // 保存旧的评估数据\n      groups: [],\n      // 班级分组信息\n      selectedGroupIdList: [],\n      studentList: [],\n      selectedMemberIdList: [],\n      selectedMemberNameList: [],\n      selectedStudentNameList: [],\n      EvaluationTableType: EvaluationTableType["a" /* default */],\n      EvaluationTableMode: EvaluationTableMode["a" /* default */],\n      groupNum: 0,\n      memberNum: 0,\n      newFormType: EvaluationTableType["a" /* default */].CenturySkills,\n      rubricType: \'create\',\n      newTableName: \'21st Century Skills\',\n      currentEditingTitle: null,\n      currentFormItem: null,\n      studentEvaluateData: {},\n      // 所有学生的评价数据对象，通过vue.$set设置属性，方便遍历对应的学生及表单数据\n      currentActiveStudentId: null,\n      allStudentUserIdList: [],\n      evidenceSelectVisible: false,\n      currentEvidenceItem: null,\n      // 当前正在操作的小组id\n      currentActiveGroupId: null,\n      formSaving: false,\n      showEvaluationNoticeVisible: false,\n      studentEvaluateIdList: [],\n      peerEvaluateIdList: [],\n      // 当前用户所在组，他评用\n      currentUserGroupId: null,\n      currentUserGroupUserIdList: [],\n      typeMap: teacher["e" /* typeMap */],\n      taskForms: [],\n      isEmptyStudentEvaluateData: false,\n      allStudentUserList: [],\n      allNoGroupStudentUserIdList: [],\n      // 所有未分组的学生邮箱列表\n      allNoGroupStudentUserList: [],\n      // 所有未分组的学生列表\n      attendanceList: [],\n      attendanceEmailList: []\n    };\n  },\n  mixins: [EvaluationMixin["a" /* EvaluationMixin */]],\n  beforeRouteLeave: function beforeRouteLeave(to, from, next) {\n    var _this = this;\n\n    this.$logger.info(\'beforeRouteLeave\', to, from, next);\n    this.$logger.info(\'forms\', this.forms, \'oldFormsJson\', this.oldFormsJson);\n    this.$logger.info(\'studentEvaluateData\', this.studentEvaluateData, \'oldStudentEvaluationJson\', this.oldStudentEvaluationJson);\n\n    if (this.initCompleted && (JSON.stringify(this.forms) !== this.oldFormsJson || JSON.stringify(this.studentEvaluateData) !== this.oldStudentEvaluationJson)) {\n      this.$confirm({\n        title: \'Alert\',\n        okText: \'Save\',\n        cancelText: \'No\',\n        content: \'Do you want to save the changes?\',\n        onOk: function onOk() {\n          _this.handleSaveEvaluation();\n\n          setTimeout(function () {\n            next();\n          }, 1500);\n        },\n        onCancel: function onCancel() {\n          next();\n        }\n      });\n    } else {\n      next();\n    }\n  },\n  created: function created() {\n    this.$logger.info(\'[\' + this.mode + \'] created ClassSessionEvaluation sessionId\' + this.sessionId);\n    this.initClassSessionEvaluation(); // 每次打开第一次提示多选模式\n\n    window.sessionStorage.removeItem(\'multiConfirmVisible\');\n  },\n  methods: {\n    initClassSessionEvaluation: function initClassSessionEvaluation() {\n      var _this2 = this;\n\n      this.$logger.info(\'initClassSessionEvaluation sessionId \' + this.sessionId);\n      Object(schoolClass["d" /* SchoolClassListClassAttendance */])({\n        sessionId: this.sessionId\n      }).then(function (response) {\n        _this2.$logger.info(\'SchoolClassListClassAttendance\', response);\n\n        if (response.success && response.result.length > 0) {\n          _this2.attendanceList = [];\n          _this2.attendanceEmailList = [];\n          var attendanceEmailSet = new Set();\n          response.result.forEach(function (item) {\n            if (!attendanceEmailSet.has(item.email)) {\n              _this2.attendanceList.push(item);\n\n              _this2.attendanceEmailList.push(item.email);\n\n              attendanceEmailSet.add(item.email);\n            }\n          });\n\n          _this2.$logger.info(\'attendanceList\', _this2.attendanceList);\n        }\n      }).catch(function (error) {\n        _this2.loading = false;\n\n        _this2.$logger.error(\'SchoolClassListClassAttendance\', error);\n\n        _this2.$message.error(\'SchoolClassListClassAttendance \' + error);\n      }).finally(function () {\n        _this2.loadClassSessionEvaluationData();\n      });\n    },\n    loadClassSessionEvaluationData: function loadClassSessionEvaluationData() {\n      var _this3 = this;\n\n      this.loading = true;\n      Object(evaluation["GetSessionEvaluationByClassId"])({\n        classId: this.sessionId\n      }).then(function (response) {\n        _this3.$logger.info(\'init data response\', response); // 加载班级信息数据\n\n\n        _this3.$logger.info(\'GetSessionEvaluationByClassId response\', response.result); // 所有的学生id用于遍历构造学生评价数据 "对象"\n\n\n        var allGroupStudentUserIdList = [];\n        var data = response.result;\n        _this3.classInfo = data.classInfo;\n        data.groups.forEach(function (group) {\n          group.expand = true; // 默认分组展开显示\n\n          group.attendanceList = []; // 默认分组展开显示\n\n          group.members.forEach(function (member) {\n            allGroupStudentUserIdList.push(member.userId);\n\n            if (member.userId === _this3.$store.getters.email) {\n              _this3.currentUserGroupId = group.id;\n              _this3.currentUserGroupUserIdList = group.members.map(function (member) {\n                return member.userId;\n              });\n\n              _this3.$logger.info(\'currentUserGroupId\' + _this3.currentUserGroupId, \'currentUserGroupUserIdList\', _this3.currentUserGroupUserIdList);\n            }\n\n            if (_this3.attendanceEmailList.includes(member.userId)) {\n              group.attendanceList.push(member.userId);\n            }\n          });\n        }); // 遍历所有学生，找出不存在分组中的\n\n        _this3.allNoGroupStudentUserIdList = [];\n        _this3.allNoGroupStudentUserList = [];\n\n        if (data.classMembersVos && data.classMembersVos.length) {\n          data.classMembersVos.forEach(function (item) {\n            item.userId = item.email;\n          });\n\n          _this3.$logger.info(\'formatted classMembersVos\', data.classMembersVos);\n\n          data.classMembersVos.forEach(function (studentItem) {\n            if (allGroupStudentUserIdList.indexOf(studentItem.userId) === -1) {\n              _this3.allNoGroupStudentUserIdList.push(studentItem.userId);\n\n              _this3.allNoGroupStudentUserList.push(studentItem);\n            }\n          });\n          _this3.allStudentUserList = data.classMembersVos;\n\n          _this3.allStudentUserList.forEach(function (studentItem) {\n            _this3.allStudentUserIdList.push(studentItem.email);\n          });\n        }\n\n        _this3.$logger.info(\'allNoGroupStudentUserIdList\', _this3.allNoGroupStudentUserIdList); // 使用班级信息填充表单基础信息，保持header显示的按钮标题兼容显示\n\n\n        if (data.classInfo && !data.evaluation) {\n          _this3.form.name = data.classInfo.fileName;\n          _this3.form.className = data.classInfo.className;\n          _this3.form.createBy = data.classInfo.author;\n          _this3.form.createTime = new Date(data.classInfo.date * 1000);\n          _this3.form.type = teacher["e" /* typeMap */].classSessionEvaluation;\n\n          _this3.$logger.info(\'init form data\', _this3.form);\n        }\n\n        var allStudentUserIdList = _this3.allStudentUserIdList;\n        _this3.groups = data.groups;\n\n        if (data.evaluation) {\n          _this3.evaluationId = data.evaluation.id;\n\n          _this3.updateTeacherEvaluationStatus(); // 轮询更新老师的评估模式状态\n\n\n          _this3.form = Object.assign(_this3.form, data.evaluation);\n          data.evaluation.forms.forEach(function (formItem) {\n            _this3.forms.push({\n              title: formItem.title,\n              titleEditing: false,\n              formType: formItem.formType,\n              se: formItem.se,\n              pe: formItem.pe,\n              menuVisible: false,\n              mode: formItem.mode,\n              // 0-editing 1-evaluating\n              id: formItem.id,\n              formId: formItem.formId,\n              initRawHeaders: JSON.parse(formItem.initRawHeaders),\n              initRawData: JSON.parse(formItem.initRawData)\n            });\n          });\n\n          _this3.$logger.info(\'forms\', _this3.forms);\n\n          _this3.oldFormsJson = JSON.stringify(_this3.forms); // forms为空那么数据已经失效\n\n          if (!_this3.forms.length) {\n            data.evaluation.studentEvaluateData = null;\n          }\n        }\n\n        if (_this3.forms.length) {\n          _this3.currentActiveFormId = _this3.forms[0].formId;\n        }\n\n        _this3.$logger.info(\'allStudentUserIdList\', _this3.allStudentUserIdList); // 初始化评估数据，构造遍历所有学生的评价数据对象，更具对象索引到具体表单的某一行的点评数据\n\n\n        var isEmptyStudentEvaluateData = false;\n\n        if (data.evaluation && data.evaluation.studentEvaluateData) {\n          var evaluateDataObj = JSON.parse(data.evaluation.studentEvaluateData);\n          var userIds = Object.keys(evaluateDataObj);\n\n          if (userIds.length === 0) {\n            isEmptyStudentEvaluateData = true;\n          } else {\n            userIds.forEach(function (userId) {\n              if (evaluateDataObj.hasOwnProperty(userId) && Object.keys(evaluateDataObj[userId]).length === 0) {\n                isEmptyStudentEvaluateData = true;\n              }\n            });\n          }\n        } else {\n          isEmptyStudentEvaluateData = true;\n        }\n\n        _this3.isEmptyStudentEvaluateData = isEmptyStudentEvaluateData;\n\n        _this3.$logger.info(\'isEmptyStudentEvaluateData \' + isEmptyStudentEvaluateData, data.evaluation);\n\n        if (!isEmptyStudentEvaluateData) {\n          var studentEvaluateData = JSON.parse(data.evaluation.studentEvaluateData);\n\n          _this3.$logger.info(\'exist studentEvaluateData\', studentEvaluateData); // 处理新增的学生\n\n\n          allStudentUserIdList.forEach(function (studentId) {\n            if (!studentEvaluateData.hasOwnProperty(studentId)) {\n              _this3.$logger.info(\'new student\', studentId);\n\n              studentEvaluateData[studentId] = {};\n\n              _this3.forms.forEach(function (formItem) {\n                studentEvaluateData[studentId][formItem.formId] = {\n                  comment: null,\n                  question1: null,\n                  // 学生回答的三个问题内容\n                  question2: null,\n                  question3: null\n                };\n                formItem.initRawData.forEach(function (rowItem) {\n                  studentEvaluateData[studentId][formItem.formId][rowItem.rowId] = {\n                    teacherEvaluation: null,\n                    // 老师评价\n                    teacherName: null,\n                    // 老师评价\n                    teacherEmail: null,\n                    // 老师评价\n                    peerEvaluation: null,\n                    // 他人评价\n                    peerName: null,\n                    // 他人评价\n                    peerEmail: null,\n                    // 他人评价\n                    studentEvaluation: null,\n                    // 学生自评\n                    studentName: null,\n                    // 学生自评\n                    studentEmail: null,\n                    // 学生自评\n                    data: null,\n                    // subLevel数据\n                    evidenceIdList: [],\n                    // ppt证据pageId列表\n                    evidenceIdStudentList: [] // ppt证据pageId列表-学生选择\n\n                  };\n                });\n              });\n            }\n          });\n          _this3.studentEvaluateData = studentEvaluateData;\n          _this3.oldStudentEvaluationJson = data.evaluation.studentEvaluateData;\n\n          if (allStudentUserIdList.length && _this3.mode !== EvaluationTableMode["a" /* default */].Edit && _this3.mode !== EvaluationTableMode["a" /* default */].Preview) {\n            _this3.currentActiveStudentId = _this3.$store.getters.email;\n\n            _this3.selectedMemberIdList.push(_this3.currentActiveStudentId);\n          }\n\n          _this3.$logger.info(\'restore studentEvaluateData\', _this3.studentEvaluateData);\n        } else if (allStudentUserIdList.length && _this3.forms.length) {\n          // 初始化学生表格数据, studentEvaluateData[学生Id][表单Id][列Id] = 列数据\n          var _studentEvaluateData = {};\n          allStudentUserIdList.forEach(function (studentId) {\n            _studentEvaluateData[studentId] = {};\n\n            _this3.forms.forEach(function (formItem) {\n              _studentEvaluateData[studentId][formItem.formId] = {\n                comment: null,\n                question1: null,\n                // 学生回答的三个问题内容\n                question2: null,\n                question3: null\n              };\n              formItem.initRawData.forEach(function (rowItem) {\n                _studentEvaluateData[studentId][formItem.formId][rowItem.rowId] = {\n                  teacherEvaluation: null,\n                  // 老师评价\n                  teacherName: null,\n                  // 老师评价\n                  teacherEmail: null,\n                  // 老师评价\n                  peerEvaluation: null,\n                  // 他人评价\n                  peerName: null,\n                  // 他人评价\n                  peerEmail: null,\n                  // 他人评价\n                  studentEvaluation: null,\n                  // 学生自评\n                  studentName: null,\n                  // 学生自评\n                  studentEmail: null,\n                  // 学生自评\n                  data: null,\n                  // subLevel数据\n                  evidenceIdList: [],\n                  // ppt证据pageId列表\n                  evidenceIdStudentList: [] // ppt证据pageId列表-学生选择\n\n                };\n              });\n            });\n          });\n\n          _this3.$logger.info(\'studentEvaluateData init finished \', _studentEvaluateData);\n\n          _this3.studentEvaluateData = _studentEvaluateData;\n          _this3.oldStudentEvaluationJson = JSON.stringify(_studentEvaluateData);\n\n          if (_this3.mode !== EvaluationTableMode["a" /* default */].Edit && _this3.mode === EvaluationTableMode["a" /* default */].Preview) {\n            // 默认选中第一个学生的第一个评估表格\n            _this3.currentActiveStudentId = allGroupStudentUserIdList[0];\n\n            _this3.selectedMemberIdList.push(_this3.currentActiveStudentId);\n\n            _this3.$logger.info(\'currentActiveFormId \' + _this3.currentActiveFormId + \' currentActiveStudentId \' + _this3.currentActiveStudentId);\n          } // 老师评估模式默认选中第一个学生\n\n\n          if (_this3.mode === EvaluationTableMode["a" /* default */].TeacherEvaluate) {\n            _this3.currentActiveStudentId = allStudentUserIdList[0];\n\n            _this3.selectedMemberIdList.push(_this3.currentActiveStudentId);\n          }\n        } // 表单数据赋值\n\n\n        _this3.form.className = _this3.classInfo.className;\n        _this3.form.type = teacher["e" /* typeMap */].classSessionEvaluation;\n        _this3.form.evaluationMode = _this3.mode;\n        _this3.form.email = _this3.$store.getters.email;\n      }).finally(function () {\n        if (_this3.mode === EvaluationTableMode["a" /* default */].StudentEvaluate) {\n          _this3.$logger.info(\'StudentEvaluate try fix currentActiveStudentId \' + _this3.$store.getters.email, \'allStudentUserIdList\', _this3.allStudentUserIdList);\n\n          if (_this3.allStudentUserIdList.indexOf(_this3.$store.getters.email) === -1) {\n            _this3.$logger.info(\'current use email \' + _this3.$store.getters.email + \' not exist in \', _this3.allStudentUserIdList, \' cannot student evaluate\');\n\n            _this3.$confirm({\n              content: \'You are not in the student list of the current class and cannot evaluate !\'\n            });\n          } else {\n            _this3.currentActiveStudentId = _this3.$store.getters.email;\n            _this3.selectedMemberIdList = [_this3.$store.getters.email];\n          }\n\n          _this3.currentActiveStudentId = _this3.$store.getters.email;\n          _this3.selectedMemberIdList = [_this3.$store.getters.email];\n        }\n\n        _this3.updateTeacherEvaluationStatus();\n\n        _this3.loading = false;\n        _this3.initCompleted = true;\n      });\n    },\n    updateTeacherEvaluationStatus: function updateTeacherEvaluationStatus() {\n      var _this4 = this;\n\n      Object(evaluation["GetEvaluationMode"])({\n        sessionId: this.sessionId\n      }).then(function (response) {\n        if (response.success) {\n          var oldMode = _this4.showWaitingMask;\n          _this4.showWaitingMask = response.result.mode === TeacherEvaluationStatus["a" /* default */].Editing; // 老师编辑完页面，重新刷新加载！\n\n          if (oldMode && !_this4.showWaitingMask) {\n            _this4.initCompleted = false;\n            window.location.reload();\n          }\n        }\n      });\n    },\n    handleActiveForm: function handleActiveForm(idx, formItem) {\n      this.$logger.info(\'handleActiveForm \' + idx, formItem);\n\n      if (this.currentActiveFormId !== formItem.formId) {\n        this.currentActiveFormId = formItem.formId;\n      }\n    },\n    handleClickMember: function handleClickMember(group, member) {\n      this.$logger.info(\'handleClickMember\', \'group\', group, \'member\', member, \'selectedMemberIdList\', this.selectedMemberIdList);\n\n      if (member.userId !== this.currentActiveStudentId) {\n        this.$message.warn(\'Currently in self-assessment mode, you cannot use to view other people\\\'s assessment data\');\n      }\n    },\n    handleSelectGroup: function handleSelectGroup(group) {\n      this.$logger.info(\'handleSelectGroup\', group);\n    },\n    handleToggleGroupExpand: function handleToggleGroupExpand(group, event) {\n      event.stopPropagation();\n      event.preventDefault();\n      this.$logger.info(\'handleToggleGroupExpand\', group);\n      group.expand = !group.expand;\n    },\n    handleEditFormTitle: function handleEditFormTitle(formItem) {\n      this.$logger.info(\'handleEditFormTitle\', formItem);\n\n      if (this.mode === EvaluationTableMode["a" /* default */].Edit) {\n        if (this.currentFormItem) {\n          this.currentFormItem.titleEditing = false;\n          this.currentFormItem = null;\n        }\n\n        this.currentEditingTitle = formItem.title;\n        formItem.titleEditing = true;\n        this.currentFormItem = formItem;\n      }\n    },\n    handleEnsureUpdateFormTitle: function handleEnsureUpdateFormTitle() {\n      this.$logger.info(\'handleEnsureUpdateFormTitle\', this.currentEditingTitle);\n      this.currentFormItem.title = this.currentEditingTitle;\n      this.currentFormItem.titleEditing = false;\n    },\n    goBack: function goBack() {\n      var _this5 = this;\n\n      if (window.history.length <= 1) {\n        this.$router.push({\n          path: router_config["d" /* defaultStudentRouter */]\n        });\n        return false;\n      } else {\n        this.$router.go(-1);\n      }\n\n      setTimeout(function () {\n        _this5.$router.push({\n          path: router_config["d" /* defaultStudentRouter */]\n        });\n      }, 500);\n    },\n    // switchEvaluate标识是否跳转到评估页面，true为跳转，false为不跳转\n    handleSaveEvaluation: function handleSaveEvaluation(switchEvaluate) {\n      var _this6 = this;\n\n      this.$logger.info(\'handleSaveEvaluation\', this.forms);\n      this.formSaving = true;\n      this.showEvaluationNoticeVisible = false; // 获取所有的表格结构（表头+表内容）\n\n      var formDataList = [];\n      this.$refs.evaluationTable.forEach(function (tableItem) {\n        var tableData = tableItem.getTableStructData();\n\n        _this6.$logger.info(\'getTableStructData \', tableData, \'header\', tableData.headers, \'row list\', tableData.list);\n\n        _this6.forms.forEach(function (formItem) {\n          if (formItem.formId === tableData.formId) {\n            var formData = {\n              id: formItem.id,\n              formId: formItem.formId,\n              formType: formItem.formType,\n              title: formItem.title,\n              initRawHeaders: JSON.stringify(tableData.headers),\n              initRawData: JSON.stringify(tableData.list),\n              pe: formItem.pe,\n              se: formItem.se\n            };\n            formDataList.push(formData);\n          }\n        });\n      });\n      this.$logger.info(\'formDataList\', formDataList, \'this.form\', this.form, \'this.sessionId\', this.sessionId);\n      this.form.classId = this.sessionId;\n      this.form.forms = formDataList; // 获取评估数据\n\n      this.$logger.info(\'!!!!!!!!!!!!!!!!!! studentEvaluateData !!!!!!!!!!!\', this.studentEvaluateData);\n      this.form.studentEvaluateData = JSON.stringify(this.studentEvaluateData);\n\n      if (formDataList.length === 0) {\n        this.$message.error(\'Please add at least one form!\');\n        this.formSaving = false;\n\n        if (switchEvaluate) {\n          this.goEvaluatePage();\n        }\n\n        return false;\n      } else {\n        Object(evaluation["SaveSessionEvaluation"])(this.form).then(function (response) {\n          _this6.$logger.info(\'SaveSessionEvaluation\', response);\n\n          _this6.$message.success(\'Save successfully!\');\n\n          _this6.formSaving = false;\n        }).then(function () {\n          var currentForm = _this6.forms.filter(function (item) {\n            return item.formId === _this6.currentActiveFormId;\n          });\n\n          _this6.$logger.info(\'currentForm\', currentForm);\n\n          if (currentForm.length) {\n            currentForm = currentForm[0];\n          } else {\n            currentForm = null;\n          }\n\n          if (_this6.mode === EvaluationTableMode["a" /* default */].TeacherEvaluate && currentForm && (currentForm.pe || currentForm.se)) {\n            Object(evaluation["GetSessionEvaluationByClassId"])({\n              classId: _this6.sessionId\n            }).then(function (response) {\n              _this6.$logger.info(\'after SaveSessionEvaluation GetSessionEvaluationByClassId\', response);\n\n              var data = response.result;\n\n              if (data.evaluation && data.evaluation.studentEvaluateData) {\n                var evaluateDataObj = JSON.parse(data.evaluation.studentEvaluateData);\n                var userIds = Object.keys(evaluateDataObj);\n                _this6.studentEvaluateIdList = [];\n                _this6.peerEvaluateIdList = [];\n                var studentEvaluateIdList = [];\n                var peerEvaluateIdList = [];\n                userIds.forEach(function (userId) {\n                  _this6.$logger.info(\'userId \' + userId, evaluateDataObj[userId]);\n\n                  var studentData = evaluateDataObj[userId];\n                  var formData = studentData[_this6.currentActiveFormId];\n\n                  _this6.$logger.info(\'user form data\', formData); // 统计是否自评\n\n\n                  var rowKeys = Object.keys(formData);\n                  rowKeys.forEach(function (rowId) {\n                    if (rowId.startsWith(\'row_\')) {\n                      // 如果学生有过自评\n                      if (studentEvaluateIdList.indexOf(userId) === -1 && !!formData[rowId].studentEvaluation) {\n                        studentEvaluateIdList.push(userId);\n                      } // 如果学生有被他评，记录下他评的邮箱\n\n\n                      if (peerEvaluateIdList.indexOf(userId) === -1 && !!formData[rowId].peerEvaluation) {\n                        peerEvaluateIdList.push(formData[rowId].peerEmail);\n                      }\n                    }\n                  });\n                });\n\n                _this6.$logger.info(\'studentEvaluateIdList\', studentEvaluateIdList, \'peerEvaluateIdList\', peerEvaluateIdList);\n\n                _this6.studentEvaluateIdList = studentEvaluateIdList;\n                _this6.peerEvaluateIdList = peerEvaluateIdList;\n                _this6.showEvaluationNoticeVisible = true;\n              }\n            });\n          }\n        }).finally(function () {\n          if (switchEvaluate) {\n            setTimeout(function () {\n              _this6.goEvaluatePage();\n            }, 1000);\n          }\n        });\n      }\n    },\n    goEvaluatePage: function goEvaluatePage() {\n      this.$logger.info(\'goEvaluatePage\'); // window.location.pathname = defaultStudentRouter\n    },\n    handleSaveAndBackEvaluation: function handleSaveAndBackEvaluation() {\n      var _this7 = this;\n\n      this.$logger.info(\'handleSaveAndBackEvaluation\', this.forms);\n\n      if (!this.isEmptyStudentEvaluateData && this.mode === EvaluationTableMode["a" /* default */].Edit) {\n        this.$info({\n          title: \'Notice\',\n          content: \'After modifying the form, all student evaluation data will be cleared\',\n          onOk: function onOk() {\n            _this7.$logger.info(\'handleSaveAndBackEvaluation onOk\');\n\n            _this7.formSaving = true;\n            _this7.showEvaluationNoticeVisible = false; // 获取所有的表格结构（表头+表内容）\n\n            var formDataList = [];\n\n            _this7.$refs.evaluationTable.forEach(function (tableItem) {\n              var tableData = tableItem.getTableStructData();\n\n              _this7.$logger.info(\'getTableStructData \', tableData, \'header\', tableData.headers, \'row list\', tableData.list);\n\n              _this7.forms.forEach(function (formItem) {\n                if (formItem.formId === tableData.formId) {\n                  var formData = {\n                    id: formItem.id,\n                    formId: formItem.formId,\n                    formType: formItem.formType,\n                    title: formItem.title,\n                    initRawHeaders: JSON.stringify(tableData.headers),\n                    initRawData: JSON.stringify(tableData.list),\n                    pe: formItem.pe,\n                    se: formItem.se\n                  };\n                  formDataList.push(formData);\n                }\n              });\n            });\n\n            _this7.$logger.info(\'formDataList\', formDataList, \'this.form\', _this7.form, \'this.sessionId\', _this7.sessionId);\n\n            _this7.form.classId = _this7.sessionId;\n            _this7.form.forms = formDataList; // 获取评估数据\n\n            _this7.$logger.info(\'!!!!!!!!!!!!!!!!!! studentEvaluateData !!!!!!!!!!!\', _this7.studentEvaluateData);\n\n            _this7.form.studentEvaluateData = \'{}\';\n\n            if (formDataList.length === 0) {\n              _this7.$message.error(\'Please add at least one form!\');\n\n              _this7.formSaving = false;\n              return false;\n            } else {\n              Object(evaluation["SaveSessionEvaluation"])(_this7.form).then(function (response) {\n                _this7.$logger.info(\'SaveSessionEvaluation\', response);\n\n                if (response.success) {\n                  _this7.$message.success(\'Save successfully!\');\n\n                  _this7.formSaving = false;\n\n                  _this7.$router.push({\n                    path: \'/teacher/main/created-by-me\'\n                  });\n                } else {\n                  _this7.$message.error(response.message);\n                }\n              });\n            }\n          }\n        });\n      } else {\n        this.formSaving = true;\n        this.showEvaluationNoticeVisible = false; // 获取所有的表格结构（表头+表内容）\n\n        var formDataList = [];\n        this.$refs.evaluationTable.forEach(function (tableItem) {\n          var tableData = tableItem.getTableStructData();\n\n          _this7.$logger.info(\'getTableStructData \', tableData, \'header\', tableData.headers, \'row list\', tableData.list);\n\n          _this7.forms.forEach(function (formItem) {\n            if (formItem.formId === tableData.formId) {\n              var formData = {\n                id: formItem.id,\n                formId: formItem.formId,\n                formType: formItem.formType,\n                title: formItem.title,\n                initRawHeaders: JSON.stringify(tableData.headers),\n                initRawData: JSON.stringify(tableData.list),\n                pe: formItem.pe,\n                se: formItem.se\n              };\n              formDataList.push(formData);\n            }\n          });\n        });\n        this.$logger.info(\'formDataList\', formDataList, \'this.form\', this.form, \'this.sessionId\', this.sessionId);\n        this.form.classId = this.sessionId;\n        this.form.forms = formDataList; // 获取评估数据\n\n        this.$logger.info(\'!!!!!!!!!!!!!!!!!! studentEvaluateData !!!!!!!!!!!\', this.studentEvaluateData);\n        this.form.studentEvaluateData = JSON.stringify(this.studentEvaluateData);\n\n        if (formDataList.length === 0) {\n          this.$message.error(\'Please add at least one form!\');\n          this.formSaving = false;\n          return false;\n        } else {\n          Object(evaluation["SaveSessionEvaluation"])(this.form).then(function (response) {\n            _this7.$logger.info(\'SaveSessionEvaluation\', response);\n\n            if (response.success) {\n              _this7.$message.success(\'Save successfully!\');\n\n              _this7.formSaving = false;\n\n              _this7.$router.push({\n                path: \'/teacher/main/created-by-me\'\n              });\n            } else {\n              _this7.$message.error(response.message);\n            }\n          });\n        }\n      }\n    },\n    handleSaveCurrentEvaluation: function handleSaveCurrentEvaluation() {\n      var _this8 = this;\n\n      this.$logger.info(\'handleSaveCurrentEvaluation\');\n      this.showEvaluationNoticeVisible = false;\n      setTimeout(function () {\n        _this8.studentEvaluateIdList = [];\n        _this8.peerEvaluateIdList = [];\n\n        _this8.$logger.info(\'studentEvaluateIdList\', _this8.studentEvaluateIdList, \'peerEvaluateIdList\', _this8.peerEvaluateIdList);\n      }, 5000);\n    },\n    handlePublishEvaluation: function handlePublishEvaluation() {},\n    // 修改表头数据处理\n    handleUpdateForm: function handleUpdateForm(data) {\n      this.$logger.info(\'handleUpdateForm\', data);\n      this.form.name = data.name;\n    },\n    handleSelectRubric: function handleSelectRubric(newFormType) {\n      this.$logger.info(\'handleSelectRubric newFormType \' + newFormType);\n      this.newFormType = newFormType;\n\n      if (newFormType === EvaluationTableType["a" /* default */].Rubric) {\n        this.newTableName = \'Rubric \' + (this.forms.length + 1);\n      } else if (newFormType === EvaluationTableType["a" /* default */].Rubric_2) {\n        this.newTableName = \'Rubric \' + (this.forms.length + 1);\n      } else if (newFormType === EvaluationTableType["a" /* default */].CenturySkills) {\n        this.newTableName = \'21st Century Skills \' + (this.forms.length + 1);\n      }\n\n      this.$logger.info(\'newTableName\', this.newTableName);\n    },\n    handleDeleteForm: function handleDeleteForm(formItem) {\n      var _this9 = this;\n\n      this.$logger.info(\'handleDeleteForm\', formItem);\n      var forms = [];\n      this.forms.forEach(function (form) {\n        if (form.formId !== formItem.formId) {\n          forms.push(form);\n        }\n      });\n      this.forms = forms;\n\n      if (this.forms.length) {\n        this.currentActiveFormId = this.forms[this.forms.length - 1].formId;\n      }\n\n      this.allStudentUserIdList.forEach(function (studentId) {\n        _this9.$delete(_this9.studentEvaluateData[studentId], formItem.formId);\n      });\n      this.$logger.info(\'after delete \' + formItem.formId, this.studentEvaluateData);\n      this.$logger.info(\'after delete forms\' + formItem.formId, this.forms);\n    },\n    handleUpdateEvaluate: function handleUpdateEvaluate(data) {\n      var _this10 = this;\n\n      this.$logger.info(\'handleUpdateEvaluate\', data);\n      this.$logger.info(\'before update studentEvaluateData\', this.studentEvaluateData);\n\n      if (this.mode === EvaluationTableMode["a" /* default */].StudentEvaluate) {\n        // 更新当前选中的所有学生的对应的form的rowId的数据为对应列\n        var allSelectedStudentUserId = [];\n        this.selectedMemberIdList.forEach(function (userId) {\n          if (allSelectedStudentUserId.indexOf(userId) === -1) {\n            allSelectedStudentUserId.push(userId);\n          }\n        });\n        this.groups.forEach(function (group) {\n          if (_this10.selectedGroupIdList.indexOf(group.id) !== -1) {\n            group.members.forEach(function (member) {\n              if (allSelectedStudentUserId.indexOf(member.userId) === -1) {\n                allSelectedStudentUserId.push(member.userId);\n              }\n            });\n          }\n        });\n        this.$logger.info(\'all selected member userId \', allSelectedStudentUserId); // 遍历所有当前选中的用户，设置对应的选中的用-对应的表单-对应的行-对应的列-对应的评估数据\n\n        allSelectedStudentUserId.forEach(function (userId) {\n          _this10.$logger.info(data.evaluationMode + \' studentEvaluateData userId \' + userId, _this10.studentEvaluateData[userId]);\n\n          _this10.$logger.info(data.evaluationMode + \' studentEvaluateData formId \' + data.formId, _this10.studentEvaluateData[userId][data.formId]);\n\n          _this10.$logger.info(data.evaluationMode + \' studentEvaluateData rowId \' + data.rowId, _this10.studentEvaluateData[userId][data.formId][data.rowId]);\n\n          if (data.evaluationMode === EvaluationTableMode["a" /* default */].StudentEvaluate) {\n            _this10.studentEvaluateData[userId][data.formId][data.rowId].studentEmail = data.evaluateUserEmail;\n            _this10.studentEvaluateData[userId][data.formId][data.rowId].studentName = data.evaluateUserName;\n            _this10.studentEvaluateData[userId][data.formId][data.rowId].data = data.data;\n\n            if (_this10.studentEvaluateData[userId][data.formId][data.rowId].studentEvaluation === data.value) {\n              _this10.studentEvaluateData[userId][data.formId][data.rowId].studentEvaluation = \'\';\n            } else {\n              _this10.studentEvaluateData[userId][data.formId][data.rowId].studentEvaluation = data.value;\n            }\n          }\n\n          _this10.$logger.info(\'set \' + userId + \' formId \' + data.formId + \' row \' + data.rowId, _this10.studentEvaluateData[userId][data.formId][data.rowId], \'data\', data);\n        });\n      }\n\n      this.$logger.info(\'after update studentEvaluateData\', this.studentEvaluateData);\n    },\n    handleAddEvidence: function handleAddEvidence(data) {\n      this.$logger.info(\'handleAddEvidence\', data, this.selectedMemberIdList);\n\n      if (this.selectedMemberIdList.length === 1) {\n        this.evidenceSelectVisible = true;\n        this.currentEvidenceItem = data.data;\n      } else {\n        this.$message.warn(\'You can only add evidence for one student at a time, and now you\\\'ve selected \' + this.selectedMemberIdList.length + \' students\');\n      }\n    },\n    handleCancelEvidenceFinish: function handleCancelEvidenceFinish() {\n      this.evidenceSelectVisible = false;\n    },\n    handleErrorMode: function handleErrorMode() {\n      this.initCompleted = false;\n      window.location.pathname = \'/\';\n    },\n    handleEnsureEvidenceFinish: function handleEnsureEvidenceFinish(data) {\n      var _this11 = this;\n\n      this.$logger.info(\'handleEnsureEvidenceFinish\', data); // 给当前所有被选中的学生的对应rowId的evidence都加数据\n\n      var rowId = this.currentEvidenceItem.rowId; // 更新当前选中的所有学生的对应的form的rowId的数据为对应列\n\n      var allSelectedStudentUserId = [];\n      this.selectedMemberIdList.forEach(function (userId) {\n        if (allSelectedStudentUserId.indexOf(userId) === -1) {\n          allSelectedStudentUserId.push(userId);\n        }\n      });\n      this.groups.forEach(function (group) {\n        if (_this11.selectedGroupIdList.indexOf(group.id) !== -1) {\n          group.members.forEach(function (member) {\n            if (allSelectedStudentUserId.indexOf(member.userId) === -1) {\n              allSelectedStudentUserId.push(member.userId);\n            }\n          });\n        }\n      });\n      this.$logger.info(\'all selected member userId \', allSelectedStudentUserId); // 遍历所有当前选中的用户，设置对应的选中的用-对应的表单-对应的行-对应的列-对应的evidence数据\n\n      allSelectedStudentUserId.forEach(function (userId) {\n        _this11.$logger.info(\'evidence row\', _this11.studentEvaluateData[userId][_this11.currentActiveFormId][rowId]);\n\n        if (_this11.mode === EvaluationTableMode["a" /* default */].StudentEvaluate) {\n          _this11.studentEvaluateData[userId][_this11.currentActiveFormId][rowId].evidenceIdStudentList = data.data;\n        } else if (_this11.mode === EvaluationTableMode["a" /* default */].TeacherEvaluate) {\n          _this11.studentEvaluateData[userId][_this11.currentActiveFormId][rowId].evidenceIdList = data.data;\n        }\n\n        _this11.$logger.info(\'evidence update user id \' + userId + \' row \' + rowId + \' data\', _this11.studentEvaluateData[userId][_this11.currentActiveFormId][rowId]);\n      });\n      this.evidenceSelectVisible = false;\n    },\n    handleUpdateComment: function handleUpdateComment(comment) {\n      this.$logger.info(\'handleUpdateComment\');\n    }\n  }\n});\n// CONCATENATED MODULE: ./src/views/student/StudentEvaluation.vue?vue&type=script&lang=js&\n /* harmony default export */ var student_StudentEvaluationvue_type_script_lang_js_ = (StudentEvaluationvue_type_script_lang_js_); \n// EXTERNAL MODULE: ./src/views/student/StudentEvaluation.vue?vue&type=style&index=0&id=64e62c4c&lang=less&scoped=true&\nvar StudentEvaluationvue_type_style_index_0_id_64e62c4c_lang_less_scoped_true_ = __webpack_require__("6d09");\n\n// EXTERNAL MODULE: ./node_modules/@vue/cli-service/node_modules/vue-loader/lib/runtime/componentNormalizer.js\nvar componentNormalizer = __webpack_require__("0c7c");\n\n// CONCATENATED MODULE: ./src/views/student/StudentEvaluation.vue\n\n\n\n\n\n\n/* normalize component */\n\nvar component = Object(componentNormalizer["a" /* default */])(\n  student_StudentEvaluationvue_type_script_lang_js_,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  "64e62c4c",\n  null\n  \n)\n\n/* harmony default export */ var StudentEvaluation = __webpack_exports__["default"] = (component.exports);\n\n//# sourceURL=webpack:///./src/views/student/StudentEvaluation.vue_+_4_modules?')},"67b9":function(module,exports,__webpack_require__){eval("// extracted by mini-css-extract-plugin\n\n//# sourceURL=webpack:///./src/views/student/StudentEvaluation.vue?./node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!./node_modules/@vue/cli-service/node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!./node_modules/@vue/cli-service/node_modules/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/postcss-loader/src??ref--10-oneOf-1-2!./node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!./node_modules/cache-loader/dist/cjs.js??ref--0-0!./node_modules/@vue/cli-service/node_modules/vue-loader/lib??vue-loader-options")},"6d09":function(module,__webpack_exports__,__webpack_require__){"use strict";eval('/* harmony import */ var _node_modules_mini_css_extract_plugin_dist_loader_js_ref_10_oneOf_1_0_node_modules_vue_cli_service_node_modules_css_loader_dist_cjs_js_ref_10_oneOf_1_1_node_modules_vue_cli_service_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_10_oneOf_1_2_node_modules_less_loader_dist_cjs_js_ref_10_oneOf_1_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_cli_service_node_modules_vue_loader_lib_index_js_vue_loader_options_StudentEvaluation_vue_vue_type_style_index_0_id_64e62c4c_lang_less_scoped_true___WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__("67b9");\n/* harmony import */ var _node_modules_mini_css_extract_plugin_dist_loader_js_ref_10_oneOf_1_0_node_modules_vue_cli_service_node_modules_css_loader_dist_cjs_js_ref_10_oneOf_1_1_node_modules_vue_cli_service_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_10_oneOf_1_2_node_modules_less_loader_dist_cjs_js_ref_10_oneOf_1_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_cli_service_node_modules_vue_loader_lib_index_js_vue_loader_options_StudentEvaluation_vue_vue_type_style_index_0_id_64e62c4c_lang_less_scoped_true___WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_node_modules_mini_css_extract_plugin_dist_loader_js_ref_10_oneOf_1_0_node_modules_vue_cli_service_node_modules_css_loader_dist_cjs_js_ref_10_oneOf_1_1_node_modules_vue_cli_service_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_src_index_js_ref_10_oneOf_1_2_node_modules_less_loader_dist_cjs_js_ref_10_oneOf_1_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_cli_service_node_modules_vue_loader_lib_index_js_vue_loader_options_StudentEvaluation_vue_vue_type_style_index_0_id_64e62c4c_lang_less_scoped_true___WEBPACK_IMPORTED_MODULE_0__);\n/* unused harmony reexport * */\n\n\n//# sourceURL=webpack:///./src/views/student/StudentEvaluation.vue?')}}]);