(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4576176c"],{b549:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"my-full-form-wrapper",attrs:{id:"formRoot"}},[i("fixed-form-header",{scopedSlots:t._u([{key:"header",fn:function(){return[i("form-header",{attrs:{title:t.title,"show-share":!1,"show-collaborate":!1,"is-preview-mode":!0},on:{back:t.goBack},scopedSlots:t._u([{key:"back",fn:function(){return[i("img",{staticClass:"single-logo-img",attrs:{src:a("be50"),alt:"classcipe"},on:{click:function(e){return e.stopPropagation(),t.$router.push("/")}}})]},proxy:!0},{key:"left",fn:function(){return[i("a-space",{attrs:{size:5,align:"center"},on:{click:function(t){t.stopPropagation()}}},[i("label",{staticStyle:{cursor:"pointer"},on:{click:function(e){return t.$router.push("/account/info")}}},[t._v("Account Info")]),i("label",{attrs:{for:""}},[t._v(">")]),i("label",{staticStyle:{cursor:"pointer"},on:{click:function(e){return t.$router.push("/manage/teacher")}}},[t._v("School Teacher")]),i("label",{attrs:{for:""}},[t._v(">")]),i("label",{staticStyle:{"font-weight":"normal"}},[t._v(t._s(t.title))])])]},proxy:!0},{key:"right",fn:function(){},proxy:!0}])})]},proxy:!0}])}),i("div",{staticClass:"form-content"},[i("div",{staticClass:"filter-tab"},[i("div"),i("a-space",{staticClass:"filter-opt"},[i("a-button",{attrs:{type:"primary"},on:{click:t.downloadTemplate}},[t._v("Download template")]),i("school-user-import",{attrs:{dataKey:t.dataKey,action:t.importExcelUrl},on:{success:t.handleImportGet}})],1)],1),i("div",{staticClass:"form-tab"},[i("a-spin",{attrs:{spinning:t.loading}},[i("school-user-upload",{ref:"schoolUserUpload",attrs:{columns:t.columns,datas:t.datas,verify:t.justifyStatus,verifyDuplicate:t.verifyDuplicate},on:{change:t.handelChangeData,save:t.handleSave}})],1)],1)]),i("fixed-form-footer",{scopedSlots:t._u([{key:"right",fn:function(){return[i("custom-text-button",{attrs:{label:"Add selected teachers"},on:{click:t.handleAddUser}})]},proxy:!0}])})],1)},n=[],o=a("1da1"),s=a("3835"),r=a("5530"),c=(a("96cf"),a("d3b7"),a("3ca3"),a("ddb0"),a("a15b"),a("4de4"),a("d81d"),a("ac1f"),a("1276"),a("498a"),a("7db0"),a("b0c0"),a("99af"),a("2b3d"),a("159b"),a("caad"),a("2532"),a("5319"),a("f93e")),l=a("6e84"),u=a("21fb"),d=a("b5ff8"),m=a("b5a9"),f=a("920f"),h=a("20ae"),p=a("1802"),v=a("85a6"),b=a("ad59"),g=a("ec09"),y=a("2f62"),E=a("c1df"),S=a.n(E),k=a("ca00"),D=a("4fcf"),w=D.debounce,x=D.mergeWith,j={name:"SchoolTeacherUpload",mixins:[l["a"],u["a"]],components:{FixedFormHeader:d["a"],FixedFormFooter:f["a"],FormHeader:m["a"],CustomTextButton:h["a"],SchoolUserUpload:p["a"],SchoolUserImport:v["a"]},props:{id:{type:String,default:null}},data:function(){return{USER_MODE:c["X"],SCHOOL_USER_STATUS:c["A"],baseUrl:"https://api.classcipe.com",importExcelUrl:"",datas:[],dataKey:["firstName","lastName","inviteEmail","birthDay","classes","roles"],remoteEmails:[],waitToEmails:[],columns:[{title:"First Name",align:"center",dataIndex:"firstName",width:150,scopedSlots:{customRender:"firstName"}},{title:"Last Name",align:"center",dataIndex:"lastName",width:150,scopedSlots:{customRender:"lastName"}},{title:"Email",align:"center",dataIndex:"inviteEmail",width:200,scopedSlots:{customRender:"inviteEmail"}},{title:"Action",align:"center",scopedSlots:{customRender:"action"}}],loading:!1}},created:function(){this.debounceLoad=w(this.loadData,300),this.initDict()},computed:Object(r["a"])(Object(r["a"])({},Object(y["e"])({userMode:function(t){return t.app.userMode},currentSchool:function(t){return t.user.currentSchool}})),{},{title:function(){return"Upload"}}),methods:{goBack:function(){this.$router.go(-1)},handleSchoolChange:function(t){this.userMode===c["X"].SCHOOL&&(this.queryParam.schoolId=t.id,this.initDict(),this.debounceInit())},handleModeChange:function(t){this.initDict(),this.debounceInit()},loadData:function(){},initDict:function(){var t=this;Promise.all([Object(b["h"])({schoolId:this.currentSchool.id,queryType:0,pageNo:1,pageSize:1e4})]).then((function(e){var a=Object(s["a"])(e,1),i=a[0];0===i.code&&(t.classList=i.result.records)}))},handelChangeData:function(t){this.datas=t,this.reJustifyInviteEmail(this.datas)},handleImportGet:function(t){var e=this,a=t.map((function(t){return t.inviteEmail})).filter((function(t){return!!t})).join(",");this.loading=!0,Object(g["k"])({schoolId:this.currentSchool.id,emails:a}).then((function(a){if(0===a.code){e.remoteEmails=x(e.remoteEmails,a.result);var i=t.map((function(t){var a=e.justifyStatus(t);return t.status=a,t.classes&&(t.classes=t.classes.split(",").map((function(t){var a=t.trim(),i=e.classList.find((function(t){return t.name===a}));return i?i.id:""})).filter((function(t){return!!t})).join(",")),t.birthDay&&(t.birthDay=S()(t.birthDay,"DD/MM/YYYY").format("YYYY-MM-DD HH:mm:ss")),t.schoolId=e.currentSchool.id,t.key=100*Math.random()+(new Date).getTime(),t}));e.datas=e.datas.concat(i),e.reJustifyInviteEmail(e.datas)}})).finally((function(){e.loading=!1}))},downloadTemplate:function(){var t=document.createElement("a");t.style.display="none";var e=this.baseUrl+"/classcipe/excel/Teacher_bulk_import.xlsx";t.href=e,document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(e)},handleSave:function(t){},handleAddUser:function(){var t=this;this.$refs.schoolUserUpload.selectionRows.length>0?(this.loading=!0,Object(g["f"])(this.$refs.schoolUserUpload.selectionRows).then((function(e){0===e.code&&(t.datas=[],t.$message.success("Import successfully"),t.goBack())})).finally((function(){t.loading=!1}))):this.$message.error("Please select at least one to import")},reJustifyInviteEmail:function(t){var e={};t.forEach((function(t){if(Object(k["isEmail"])(t.inviteEmail))if(e[t.inviteEmail]){var a=t.status?t.status.map((function(t){return"inviteEmail"===t.col})).map((function(t){return t.msg})).filter((function(t){return!!t})):[];a.includes("Local Duplicate")||a.push("Local Duplicate"),t.status.push({col:"inviteEmail",msg:a.join(",")})}else{var i=t.status?t.status.map((function(t){return"inviteEmail"===t.col})).map((function(t){return t.msg})).filter((function(t){return!!t})).join(","):"";t.status.push({col:"inviteEmail",msg:i.replace("Local Duplicate","").split(",").filter((function(t){return!!t})).join(",")}),e[t.inviteEmail]=!0}}))},justifyStatus:function(t){var e={};this.remoteEmails.forEach((function(t){e[t.email]=t.exists}));var a=[];return Object(k["isEmpty"])(t.firstName)&&a.push({col:"firstName",msg:"Invalid Name"}),Object(k["isEmpty"])(t.lastName)&&a.push({col:"lastName",msg:"Invalid Name"}),Object(k["isEmpty"])(t.inviteEmail)||!Object(k["isEmail"])(t.inviteEmail)?a.push({col:"inviteEmail",msg:"Invalid Email"}):e[t.inviteEmail]&&a.push({col:"inviteEmail",msg:"Duplicate"}),a},verifyDuplicate:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function a(){var i,n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(i=[],!t.inviteEmail){a.next=6;break}return a.next=4,Object(g["k"])({schoolId:e.currentSchool.id,emails:t.inviteEmail});case 4:n=a.sent,0===n.code&&n.result&&n.result.length>0&&n.result[0].exists&&i.push({col:"inviteEmail",msg:"Duplicate"});case 6:return a.abrupt("return",i);case 7:case"end":return a.stop()}}),a)})))()}}},U=j,I=(a("fb64"),a("0c7c")),O=Object(I["a"])(U,i,n,!1,null,"209f3560",null);e["default"]=O.exports},f7e1:function(t,e,a){},fb64:function(t,e,a){"use strict";a("f7e1")}}]);